<!DOCTYPE html>
<html>
<head>
    <title>Dug Hill Rod & Gun Club Membership Database</title>
</head>
<body style="background-color:#384839; font-family:Arial, Helvetica, sans-serif;">
    <div style="display:flex; flex-direction:column; align-items:center;">
        <div style="display:flex; flex-direction:row; align-items:center; justify-content:center; margin-bottom:20px; width:100%;">
            <img src="{{ url_for('static', filename='Club_logo_smaller-removebg-preview.png') }}" alt="Club Logo Left" style="height:120px; margin-right:32px;">
            <div style="text-align:center;">
                <h1 style="margin-bottom:0.2em; color:#f5f5f5;">Dug Hill Rod & Gun Club</h1>
                <h1 style="margin-top:0.2em; color:#f5f5f5;">Membership Database</h1>
            </div>
            <img src="{{ url_for('static', filename='Club_logo_smaller-removebg-preview.png') }}" alt="Club Logo Right" style="height:120px; margin-left:32px;">
        </div>
        <form method="get" action="{{ url_for('index') }}" style="width:100%; max-width:700px; margin-bottom:10px; display:flex; justify-content:center; align-items:center;">
            <input type="text" name="search" value="{{ search }}" placeholder="Search all columns..." style="width:400px; height:38px; font-size:1.2em; padding:0 16px; border-radius:6px; border:1px solid #ccc; margin-right:12px;">
            <button type="submit" style="height:38px; font-size:1em; margin-right:8px;">Search</button>
            <button type="button" onclick="window.location='{{ url_for('index') }}'" style="height:38px; font-size:1em;">Reset</button>
        </form>
        <div style="margin-bottom:18px; text-align:center;">
            <a href="{{ url_for('add_member') }}" style="display:inline-block; padding:8px 22px; margin:0 8px; border-radius:6px; border:1px solid #ccc; background-color:#f8f8f8; color:#333; text-decoration:none; font-weight:normal; box-shadow:0 1px 2px rgba(0,0,0,0.04);">‚ûï Add Member</a>
            <a href="{{ url_for('recycle_bin') }}" style="display:inline-block; padding:8px 22px; margin:0 8px; border-radius:6px; border:1px solid #ccc; background-color:#f8f8f8; color:#333; text-decoration:none; font-weight:normal; box-shadow:0 1px 2px rgba(0,0,0,0.04);">üóëÔ∏è View Recycle Bin</a>
        </div>
        <div style="margin-bottom:18px; text-align:center;">
            {% for mt in member_types %}
                <a href="{{ url_for('index', member_type=mt, search=search) }}" style="display:inline-block; padding:8px 22px; margin:0 4px; border-radius:6px; border:1px solid #ccc; background-color:{% if mt == member_type %}rgb(255,255,0){% else %}#f8f8f8{% endif %}; color:{% if mt == member_type %}#333{% else %}#333{% endif %}; text-decoration:none; font-weight:{% if mt == member_type %}bold{% else %}normal{% endif %}; box-shadow:0 1px 2px rgba(0,0,0,0.04);">{{ mt }}</a>
            {% endfor %}
        </div>
    <table border="1" cellpadding="5" cellspacing="0" style="margin:auto; width:100%; max-width:1100px; background-color:#f5f5f5;">
        <tr>
            <th onclick="sortTable(0)" id="th0">Badge</th>
            <th onclick="sortTable(1)" id="th1">Type</th>
            <th onclick="sortTable(2)" id="th2">First Name</th>
            <th onclick="sortTable(3)" id="th3">Last Name</th>
            <th onclick="sortTable(4)" id="th4">Primary Email</th>
            <th onclick="sortTable(5)" id="th5">Secondary Email</th>
            <th onclick="sortTable(6)" id="th6">Primary Phone</th>
            <th onclick="sortTable(7)" id="th7">Secondary Phone</th>
            <th>Actions</th>
        </tr>
        {% for member in members %}
    <tr class="member-row" ondblclick="window.location='{{ url_for('member_details', member_id=member['id']) }}'" style="cursor:pointer;">
<script>
// Restore double-click navigation for member rows
</script>
            <td style="text-align:center;">{{ member['badge_number'] }}</td>
            <td>{{ member['membership_type'] }}</td>
            <td>{{ member['first_name'] }}</td>
            <td>{{ member['last_name'] }}</td>
            <td>{{ member['email'] }}</td>
            <td>{{ member['email2'] }}</td>
            <td style="min-width:130px;">{{ member['phone'] }}</td>
            <td style="min-width:130px;">{{ member['phone2'] }}</td>
            <td>
                <a href="{{ url_for('member_details', member_id=member['id']) }}" class="action-btn" style="display:inline-block; width:120px; padding:2px 0; margin-right:10px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer; text-align:center; text-decoration:none; font-size:1em;">‚úèÔ∏è Edit</a>
                <form action="{{ url_for('member_report', member_id=member['id']) }}" method="get" style="display:inline; margin-bottom:4px;">
                    <button type="submit" class="action-btn" style="width:120px; padding:2px 0; margin-right:10px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer; text-align:center; font-size:1em;">üìÑ Report</button>
                </form>
                <form action="{{ url_for('delete_member', member_id=member['id']) }}" method="post" style="display:inline;">
                    <button type="submit" class="action-btn" onclick="return confirm('Are you sure you want to move this member to the recycle bin?')" style="width:120px; padding:2px 0; margin-right:10px; border-radius:6px; border:1px solid #c00; background:#ffeaea; color:#c00; cursor:pointer; text-align:center; font-size:1em;">üóëÔ∏è Delete</button>
                </form>
                <!-- Only one Delete button remains, styled to match other action buttons. -->
            </td>
        </tr>
        {% endfor %}
    </table>
    <script>
    // Highlight member row on click and make text bold, including action buttons
    document.querySelectorAll('.member-row').forEach(function(row) {
        row.addEventListener('click', function(e) {
            document.querySelectorAll('.member-row').forEach(function(r) {
                r.style.backgroundColor = '';
                r.style.fontWeight = '';
                r.querySelectorAll('.action-btn').forEach(function(btn) {
                    btn.style.fontWeight = '';
                });
            });
            row.style.backgroundColor = 'rgb(255,255,0)';
            row.style.fontWeight = 'bold';
            row.querySelectorAll('.action-btn').forEach(function(btn) {
                btn.style.fontWeight = 'bold';
            });
        });
    });

    // Sortable table columns with arrow indicators
    function sortTable(n) {
        var table = document.querySelector('table');
        var rows = Array.from(table.rows).slice(1); // skip header
        var asc = table.getAttribute('data-sort-col') == n && table.getAttribute('data-sort-dir') == 'asc' ? false : true;
        rows.sort(function(a, b) {
            var x = a.cells[n].innerText.toLowerCase();
            var y = b.cells[n].innerText.toLowerCase();
            if (!isNaN(x) && !isNaN(y)) {
                x = parseFloat(x); y = parseFloat(y);
            }
            if (x < y) return asc ? -1 : 1;
            if (x > y) return asc ? 1 : -1;
            return 0;
        });
        rows.forEach(function(row) { table.tBodies[0].appendChild(row); });
        table.setAttribute('data-sort-col', n);
        table.setAttribute('data-sort-dir', asc ? 'asc' : 'desc');
        // Remove arrows from all headers
        for (let i = 0; i < 8; i++) {
            let th = document.getElementById('th'+i);
            if (th) th.innerHTML = th.innerText.replace(/\s*[‚ñ≤‚ñº]$/, '');
        }
        // Add arrow to sorted column
        let th = document.getElementById('th'+n);
        if (th) th.innerHTML = th.innerText + (asc ? ' ‚ñ≤' : ' ‚ñº');
    }
    </script>
    </div>
    <!-- Recycle bin link moved to top -->
</body>
</html>
