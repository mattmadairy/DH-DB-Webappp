</script>
<script>
function copyEmail(inputId) {
    var input = document.getElementById(inputId);
    if (input) {
        input.select();
        input.setSelectionRange(0, 99999); // For mobile
        document.execCommand('copy');
        alert('Email copied to clipboard!');
    }
}
</script>
<!DOCTYPE html>
<html>
<head>
    <title>Dug Hill Rod & Gun Club Membership Database</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='Main_Logo-removebg-preview.png') }}">
<style>
    .active-menu {
        background-color: rgb(255,255,0) !important;
    }
    .submenu {
        display: none;
        flex-direction: column;
        margin-left: 10px;
    }
    .submenu.active {
        display: flex;
    }
    .submenu a {
        width: 160px !important;
        font-size: 0.9em !important;
        padding: 8px 0 !important;
        margin-bottom: 6px !important;
    }
    .menu-toggle {
        cursor: pointer;
        user-select: none;
    }
</style>
<script>
function toggleSubmenu() {
    var submenu = document.getElementById('reports-submenu');
    var arrow = document.getElementById('submenu-arrow');
    submenu.classList.toggle('active');
    arrow.textContent = submenu.classList.contains('active') ? '‚ñ≤' : '‚ñº';
}
</script>
</head>
<body style="background-color:#384839; font-family:Arial, Helvetica, sans-serif;">
    <div style="display:flex; flex-direction:row;">
        <!-- Static Side Menu -->
        <div style="position:fixed; top:0; left:0; height:100vh; width:210px; background-color:#2c332b; display:flex; flex-direction:column; align-items:center; padding-top:120px; z-index:100; box-shadow:2px 0 8px rgba(0,0,0,0.08); overflow-y:auto;">
            <img src="{{ url_for('static', filename='Main_Logo-removebg-preview.png') }}" alt="Main Logo" style="height:143px; margin-top:-88px; margin-left:-8px; margin-bottom:34px;">
            <a href="{{ url_for('admin_dashboard') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#007bff; color:#ffffff; text-decoration:none; font-weight:bold; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üè† Admin Home</a>
            <a href="javascript:void(0);" onclick="openModal('addMemberModal')" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">‚ûï Add Member</a>
            {% if current_user.is_admin_or_bdfl() %}
            <a href="{{ url_for('admin_applications') }}" class="{{ 'active-menu' if active_page == 'admin_applications' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'admin_applications' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üìã Applications</a>
            {% endif %}
            <a href="{{ url_for('recycle_bin') }}" class="{{ 'active-menu' if active_page == 'recycle_bin' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'recycle_bin' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üóëÔ∏è Recycle Bin</a>
            <a href="{{ url_for('bulk_actions') }}" class="{{ 'active-menu' if active_page == 'bulk_actions' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'bulk_actions' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">‚ö° Bulk Actions</a>
            
            <div class="menu-toggle" onclick="toggleSubmenu()" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">
                üìä Reports <span id="submenu-arrow">‚ñº</span>
            </div>
            <div id="reports-submenu" class="submenu {% if active_page in ['dues_report', 'work_hours_report', 'meeting_attendance_report', 'kiosk_report'] %}active{% endif %}">
                <a href="{{ url_for('dues_report') }}" class="{{ 'active-menu' if active_page == 'dues_report' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'dues_report' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üíµ Dues</a>
                <a href="{{ url_for('work_hours_report') }}" class="{{ 'active-menu' if active_page == 'work_hours_report' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'work_hours_report' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">
                    <img src="{{ url_for('static', filename='icon_work_hours.svg') }}" alt="Work Hours" style="height:1em; vertical-align:middle; margin-right:6px;"> Work Hours
                </a>
                <a href="{{ url_for('meeting_attendance_report') }}" class="{{ 'active-menu' if active_page == 'meeting_attendance_report' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'meeting_attendance_report' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">
                    <img src="{{ url_for('static', filename='icon_attendance.svg') }}" alt="Attendance" style="height:1em; vertical-align:middle; margin-right:6px;"> Meeting Attendance
                </a>
                <a href="{{ url_for('kiosk_report') }}" class="{{ 'active-menu' if active_page == 'kiosk_report' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'kiosk_report' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üü© Check-ins</a>
            </div>
            
            <a href="{{ url_for('committees') }}" class="{{ 'active-menu' if active_page == 'committees' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'committees' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üë• Committees</a>
            <a href="{{ url_for('kiosk') }}" class="{{ 'active-menu' if active_page == 'kiosk' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'kiosk' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üñ•Ô∏è Kiosk</a>
                <!-- Email List button removed -->
            {% if current_user.is_admin_or_bdfl() %}
            <a href="{{ url_for('admin_users') }}" class="{{ 'active-menu' if active_page == 'admin_users' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:{{ '#5bc0de' if active_page != 'admin_users' else 'rgb(255,255,0)' }}; color:{{ '#ffffff' if active_page != 'admin_users' else '#000000' }}; text-decoration:none; font-weight:bold; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center; position:relative;">
                <span style="display: flex; align-items: center; width: 100%; justify-content: center; text-align: center;">
                    <span style="display:inline-block; vertical-align:middle;">üë§ User Management</span>
                </span>
            </a>
            {% endif %}
            <a href="{{ url_for('member_dashboard') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#28a745; color:#ffffff; text-decoration:none; font-weight:bold; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üë§ Members Area</a>
            <a href="{{ url_for('logout') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#d9534f; color:#ffffff; text-decoration:none; font-weight:bold; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üö™ Logout</a>
            <div style="width:170px; margin-top:20px; padding:10px; border-top:1px solid #384839;">
                <div style="color:#f5f5f5; font-size:0.9em; line-height:1.6; text-align:left;">
                    <div style="margin-bottom:8px;"><strong>Life:</strong> {{ member_stats.life_members }}</div>
                    <div style="margin-bottom:8px;"><strong>Probationary, Associate, & Active:</strong> {{ member_stats.voting_members }}</div>
                    <div style="border-top:1px solid #555; padding-top:8px;"><strong>Total:</strong> {{ member_stats.total_members }}</div>
                </div>
            </div>
        </div>
        <!-- Main content area shifted right to accommodate side menu -->
        <div style="flex:1; margin-left:210px; display:flex; flex-direction:column; align-items:center;">
            <!-- Email List Button moved to search bar row -->
            {% block content %}
            <!-- Main page content goes here -->
            <div style="display:flex; flex-direction:row; justify-content:center; margin-bottom:20px; width:100%;">
                <div style="text-align:center; width:100%;">
                    <h1 style="margin-bottom:0.2em; color:#f5f5f5; font-size:3em;">Dug Hill Rod & Gun Club</h1>
                    <h1 style="margin-top:0.2em; color:#f5f5f5; font-size:3em;">Membership Database</h1>
                </div>
            </div>
            <!-- Search Bar -->
            <div style="width:100%; display:flex; justify-content:center; align-items:center; margin-bottom:18px;">
                <a href="{{ url_for('email_list', member_type=member_type) }}" style="display:inline-block; padding:8px 22px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:bold; font-size:1.1em; box-shadow:0 1px 2px rgba(0,0,0,0.04); margin-right:16px;">üìß Email List</a>
                <input id="dynamicSearch" type="text" name="search" value="{{ search|default('') }}" placeholder="Search members..." style="width:340px; padding:8px 14px; border-radius:6px; border:1px solid #ccc; font-size:1.1em; margin-right:8px; background-color:#f5f5f5;">
                <button type="button" id="searchBtn" style="padding:8px 18px; border-radius:6px; border:1px solid #ccc; background-color:#eaeaea; color:#384839; font-size:1.1em; font-weight:bold; cursor:pointer; margin-right:8px;">Search</button>
                <button type="button" id="resetBtn" style="padding:8px 18px; border-radius:6px; border:1px solid #ccc; background-color:#eaeaea; color:#384839; font-size:1.1em; font-weight:bold; cursor:pointer;">Reset</button>
            </div>
            <!-- Member Type Tabs -->
            <div style="margin-bottom:18px; text-align:center;">
                {% for mt in member_types %}
                    <a href="{{ url_for('index', member_type=mt, search=search) }}"
                       style="display:inline-block; padding:8px 22px; margin:0 4px; border-radius:6px; border:1px solid #ccc; background-color:{{ 'rgb(255,255,0)' if mt == member_type else '#f8f8f8' }}; color:#333; text-decoration:none; font-weight:{{ 'bold' if mt == member_type else 'normal' }}; box-shadow:0 1px 2px rgba(0,0,0,0.04);">
                        {{ mt }} ({{ member_counts[mt] }})
                    </a>
                {% endfor %}
            </div>
            <!-- Add Member Modal -->
            <div id="addMemberModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
                <div style="background-color:#f5f5f5; margin:4% auto; padding:20px; border:1px solid #888; width:420px; border-radius:8px; position:relative;">
                    <button onclick="closeModal('addMemberModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
                    <h3 style="margin-top:0; text-align:center;">Add Member</h3>
                    <form id="addMemberForm">
                        <div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
                            <label for="badge_number">Badge Number:</label><input type="text" id="badge_number" name="badge_number" required>
                            <label for="membership_type">Membership Type:</label>
                            <select id="membership_type" name="membership_type" required>
                                <option value="Probationary">Probationary</option>
                                <option value="Associate">Associate</option>
                                <option value="Active">Active</option>
                                <option value="Life">Life</option>
                                <option value="Honorary">Honorary</option>
                                <option value="Prospective">Prospective</option>
                                <option value="Wait List">Wait List</option>
                                <option value="Former">Former</option>
                            </select>
                            <label for="first_name">First Name:</label><input type="text" id="first_name" name="first_name" required>
                            <label for="middle_name">Middle Name:</label><input type="text" id="middle_name" name="middle_name">
                            <label for="last_name">Last Name:</label><input type="text" id="last_name" name="last_name" required>
                            <label for="suffix">Suffix:</label><input type="text" id="suffix" name="suffix">
                            <label for="nickname">Nickname:</label><input type="text" id="nickname" name="nickname">
                            <label for="dob">Date of Birth:</label><input type="date" id="dob" name="dob">
                            <label for="email">Primary Email:</label>
                            <input type="email" id="email" name="email" pattern="[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}" title="Please include a valid email with domain extension (e.g., user@example.com)">
                            <label for="email2">Secondary Email:</label>
                            <input type="email" id="email2" name="email2" pattern="[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}" title="Please include a valid email with domain extension (e.g., user@example.com)">
                            </script>
                            <script>
                            function copyEmail(inputId) {
                                var input = document.getElementById(inputId);
                                if (input) {
                                    input.select();
                                    input.setSelectionRange(0, 99999); // For mobile
                                    document.execCommand('copy');
                                    alert('Email copied to clipboard!');
                                }
                            }
                            </script>
                            <label for="phone">Primary Phone:</label><input type="text" id="phone" name="phone" placeholder="(XXX) XXX-XXXX" maxlength="14">
                            <label for="phone2">Secondary Phone:</label><input type="text" id="phone2" name="phone2" placeholder="(XXX) XXX-XXXX" maxlength="14">
                            <label for="address">Address:</label><input type="text" id="address" name="address">
                            <label for="city">City:</label><input type="text" id="city" name="city">
                            <label for="state">State:</label><input type="text" id="state" name="state">
                            <label for="zip">Zip Code:</label><input type="text" id="zip" name="zip">
                            <label for="join_date">Join Date:</label><input type="date" id="join_date" name="join_date">
                            <label for="sponsor">Sponsor:</label><input type="text" id="sponsor" name="sponsor">
                            <label for="card_internal">Card/Fob Internal Number:</label><input type="text" id="card_internal" name="card_internal">
                            <label for="card_external">Card/Fob External Number:</label><input type="text" id="card_external" name="card_external">
                        </div>
                        <div style="margin-top:18px; text-align:center;">
                            <button type="submit" style="padding:6px 18px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Add Member</button>
                            <button type="button" onclick="closeModal('addMemberModal')" style="padding:6px 18px; border-radius:6px; border:1px solid #ccc; background:#f8f8f8; color:#333; cursor:pointer; margin-left:8px;">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
            <script>
            function toggleSubmenu() {
                var submenu = document.getElementById('reports-submenu');
                var arrow = document.getElementById('submenu-arrow');
                submenu.classList.toggle('active');
                arrow.textContent = submenu.classList.contains('active') ? '‚ñ≤' : '‚ñº';
            }
            </script>
            <script>
            function openModal(id) {
                document.getElementById(id).style.display = 'block';
                document.getElementById(id).style.zIndex = 2000;
            }
            function closeModal(id) {
                document.getElementById(id).style.display = 'none';
            }
            // Phone number formatting function
            function formatPhoneNumber(input) {
                var value = input.value.replace(/\D/g, '');
                if (value.length > 0) {
                    var formatted = '';
                    if (value.length <= 3) {
                        formatted = '(' + value;
                    } else if (value.length <= 6) {
                        formatted = '(' + value.substring(0, 3) + ') ' + value.substring(3);
                    } else {
                        formatted = '(' + value.substring(0, 3) + ') ' + value.substring(3, 6) + '-' + value.substring(6, 10);
                    }
                    input.value = formatted;
                }
            }
            // Add phone formatting listeners
            document.addEventListener('DOMContentLoaded', function() {
                var phoneInput = document.getElementById('phone');
                var phone2Input = document.getElementById('phone2');
                if (phoneInput) {
                    phoneInput.addEventListener('input', function() { formatPhoneNumber(this); });
                }
                if (phone2Input) {
                    phone2Input.addEventListener('input', function() { formatPhoneNumber(this); });
                }
            });
            
            document.getElementById('addMemberForm').onsubmit = function(e) {
                e.preventDefault();
                var form = document.getElementById('addMemberForm');
                
                // Validate email fields if they have content
                var email = document.getElementById('email').value.trim();
                var email2 = document.getElementById('email2').value.trim();
                
                if (email) {
                    // Check if email has @ symbol and a dot after it
                    var atIndex = email.indexOf('@');
                    var lastDotIndex = email.lastIndexOf('.');
                    if (atIndex === -1 || lastDotIndex === -1 || lastDotIndex <= atIndex + 1 || lastDotIndex === email.length - 1) {
                        alert('Please enter a valid primary email with domain extension (e.g., user@example.com)');
                        document.getElementById('email').focus();
                        return false;
                    }
                }
                
                if (email2) {
                    // Check if email has @ symbol and a dot after it
                    var atIndex2 = email2.indexOf('@');
                    var lastDotIndex2 = email2.lastIndexOf('.');
                    if (atIndex2 === -1 || lastDotIndex2 === -1 || lastDotIndex2 <= atIndex2 + 1 || lastDotIndex2 === email2.length - 1) {
                        alert('Please enter a valid secondary email with domain extension (e.g., user@example.com)');
                        document.getElementById('email2').focus();
                        return false;
                    }
                }
                
                var formData = new FormData(form);
                console.log('Submitting form to /add_member...');
                fetch('/add_member', {
                    method: 'POST',
                    body: formData,
                    credentials: 'same-origin'
                })
                .then(function(resp) {
                    console.log('Response status:', resp.status, resp.statusText);
                    console.log('Response headers:', resp.headers);
                    
                    // Check if response is JSON
                    var contentType = resp.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        return resp.json().then(function(data) {
                            if (resp.ok && data.success) {
                                alert('Member added successfully!');
                                location.reload();
                            } else {
                                alert('Error adding member: ' + (data.error || 'Unknown error'));
                                console.error('Error details:', data);
                            }
                        });
                    } else {
                        // Response is not JSON, probably HTML error or redirect
                        return resp.text().then(function(text) {
                            console.error('Non-JSON response:', text.substring(0, 500));
                            alert('Server error: Received non-JSON response. Check console for details.');
                        });
                    }
                })
                .catch(function(error) {
                    console.error('Fetch error:', error);
                    alert('Network error: ' + error.message + '\nCheck browser console for details.');
                });
            };

            // Dynamic search bar logic
            document.addEventListener('DOMContentLoaded', function() {
                var searchInput = document.getElementById('dynamicSearch');
                var searchBtn = document.getElementById('searchBtn');
                var resetBtn = document.getElementById('resetBtn');
                if (searchInput) {
                    searchInput.addEventListener('input', filterMembers);
                }
                if (searchBtn) {
                    searchBtn.addEventListener('click', function() {
                        filterMembers();
                        searchInput.focus();
                    });
                }
                if (resetBtn) {
                    resetBtn.addEventListener('click', function() {
                        searchInput.value = '';
                        filterMembers();
                        searchInput.focus();
                    });
                }
            });

            function filterMembers() {
                var query = document.getElementById('dynamicSearch').value.toLowerCase();
                var rows = document.querySelectorAll('table tr.member-row');
                rows.forEach(function(row) {
                    var text = row.textContent.toLowerCase();
                    row.style.display = text.includes(query) ? '' : 'none';
                });
            }
            
            function generateEmailList() {
                var memberType = '{{ member_type }}';
                window.location.href = '{{ url_for("email_list") }}?member_type=' + encodeURIComponent(memberType);
            }
            </script>
            <!-- Only one tab section above the search/menu row -->
            <table border="1" cellpadding="5" cellspacing="0" style="margin:auto; width:100%; max-width:1100px; background-color:#f5f5f5;">
                <tr>
                    <th onclick="sortTable(0)" id="th0">Badge</th>
                    <th onclick="sortTable(1)" id="th1">Type</th>
                    <th onclick="sortTable(2)" id="th2">First Name</th>
                    <th onclick="sortTable(3)" id="th3">Last Name</th>
                    <th onclick="sortTable(4)" id="th4">Primary Email</th>
                    <th onclick="sortTable(5)" id="th5">Primary Phone</th>
                    {% if member_type == 'Prospective' %}<th onclick="sortTable(6)" id="th6">Status</th>{% endif %}
                    <th>Actions</th>
                </tr>
                {% for member in members %}
            <tr class="member-row" ondblclick="window.location='{{ url_for('member_details', member_id=member['id']) }}'" style="cursor:pointer;">
            <script>
            // Restore double-click navigation for member rows
            </script>
                        <td style="text-align:center;">{{ member['badge_number'] }}</td>
                        <td>{{ member['membership_type'] }}</td>
                        <td>{{ member['first_name'] }}</td>
                        <td>{{ member['last_name'] }}</td>
                        <td>
                            <div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
                                <span id="email-{{ member['id'] }}">{{ member['email'] }}</span>
                                {% if member['email'] %}
                                <button type="button" onclick="copyEmailText('email-{{ member['id'] }}')" title="Copy Email" style="padding:2px 8px; font-size:1em; cursor:pointer; margin-left:8px;">üìã</button>
                                {% endif %}
                            </div>
                        </td>
                        </script>
                        <script>
                        function copyEmailText(spanId) {
                            var span = document.getElementById(spanId);
                            if (span) {
                                var text = span.innerText || span.textContent;
                                var tempInput = document.createElement('input');
                                tempInput.value = text;
                                document.body.appendChild(tempInput);
                                tempInput.select();
                                tempInput.setSelectionRange(0, 99999);
                                document.execCommand('copy');
                                document.body.removeChild(tempInput);
                                alert('Email copied to clipboard!');
                            }
                        }
                        </script>
                        <td style="min-width:130px; text-align:center;">{{ member['phone'] }}</td>
                        {% if member_type == 'Prospective' %}
                        {% set all_done = member['application_submitted'] and member['introduced_date'] and member['background_check_submitted'] and member['background_check_passed'] %}
                        <td style="font-weight:bold; color:#111; background-color:{% if all_done %}#3ec96b{% else %}#ffe600{% endif %}; text-align:left; padding:6px 8px;">
                            <span class="status-sort-value" style="display:none;">{% if all_done %}1{% else %}0{% endif %}</span>
                            {% if all_done %}
                                <span style="font-weight:bold; color:#111;">Eligible</span>
                            {% else %}
                                <span style="display:flex; align-items:center; gap:6px;"><span style="color:{% if member['application_submitted'] %}#3ec96b{% else %}#c00{% endif %}; font-size:1.2em;">{% if member['application_submitted'] %}‚úî{% else %}‚úó{% endif %}</span> Application Received</span>
                                <span style="display:flex; align-items:center; gap:6px;"><span style="color:{% if member['introduced_date'] %}#3ec96b{% else %}#c00{% endif %}; font-size:1.2em;">{% if member['introduced_date'] %}‚úî{% else %}‚úó{% endif %}</span> Introduced</span>
                                <span style="display:flex; align-items:center; gap:6px;"><span style="color:{% if member['background_check_submitted'] %}#3ec96b{% else %}#c00{% endif %}; font-size:1.2em;">{% if member['background_check_submitted'] %}‚úî{% else %}‚úó{% endif %}</span> Background Submitted</span>
                                <span style="display:flex; align-items:center; gap:6px;"><span style="color:{% if member['background_check_passed'] %}#3ec96b{% else %}#c00{% endif %}; font-size:1.2em;">{% if member['background_check_passed'] %}‚úî{% else %}‚úó{% endif %}</span> Background Completed</span>
                            {% endif %}
                        </td>
                        {% endif %}
                        <td style="white-space:nowrap;">
                            <a href="{{ url_for('member_details', member_id=member['id']) }}" class="action-btn" style="display:inline-block; width:80px; padding:2px 0; margin-right:6px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer; text-align:center; text-decoration:none; font-size:0.9em;">‚úèÔ∏è Edit</a>
                            <form action="{{ url_for('member_report', member_id=member['id']) }}" method="get" style="display:inline; margin-bottom:4px;">
                                <button type="submit" class="action-btn" style="width:80px; padding:2px 0; margin-right:6px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer; text-align:center; font-size:0.9em;">üìÑ Report</button>
                            </form>
                            <form action="{{ url_for('delete_member', member_id=member['id']) }}" method="post" style="display:inline;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                <button type="submit" class="action-btn" onclick="return confirm('Are you sure you want to move this member to the recycle bin?')" style="width:80px; padding:2px 0; margin-right:6px; border-radius:6px; border:1px solid #c00; background:#ffeaea; color:#c00; cursor:pointer; text-align:center; font-size:0.9em;">üóëÔ∏è Delete</button>
                            </form>
                            <!-- Only one Delete button remains, styled to match other action buttons. -->
                        </td>
                    </tr>
                    {% endfor %}
            </table>
            <script>
            // Highlight member row on click and make text bold, including action buttons
            document.querySelectorAll('.member-row').forEach(function(row) {
                row.addEventListener('click', function(e) {
                    document.querySelectorAll('.member-row').forEach(function(r) {
                        r.style.backgroundColor = '';
                        r.style.fontWeight = '';
                        r.querySelectorAll('.action-btn').forEach(function(btn) {
                            btn.style.fontWeight = '';
                        });
                    });
                    row.style.backgroundColor = 'rgb(255,255,0)';
                    row.style.fontWeight = 'bold';
                    row.querySelectorAll('.action-btn').forEach(function(btn) {
                        btn.style.fontWeight = 'bold';
                    });
                });
            });

            // Sortable table columns with arrow indicators
            function sortTable(n) {
                var table = document.querySelector('table');
                var rows = Array.from(table.rows).slice(1); // skip header
                var asc = table.getAttribute('data-sort-col') == n && table.getAttribute('data-sort-dir') == 'asc' ? false : true;
                rows.sort(function(a, b) {
                    var x, y;
                    // Special handling for Status column (index 6)
                    if (n === 6) {
                        x = a.cells[n].querySelector('.status-sort-value')?.innerText || '0';
                        y = b.cells[n].querySelector('.status-sort-value')?.innerText || '0';
                        x = parseInt(x); y = parseInt(y);
                    } else {
                        x = a.cells[n].innerText.toLowerCase();
                        y = b.cells[n].innerText.toLowerCase();
                        if (!isNaN(x) && !isNaN(y)) {
                            x = parseFloat(x); y = parseFloat(y);
                        }
                    }
                    if (x < y) return asc ? -1 : 1;
                    if (x > y) return asc ? 1 : -1;
                    return 0;
                });
                rows.forEach(function(row) { table.tBodies[0].appendChild(row); });
                table.setAttribute('data-sort-col', n);
                table.setAttribute('data-sort-dir', asc ? 'asc' : 'desc');
                // Remove arrows from all headers
                for (let i = 0; i < 8; i++) {
                    let th = document.getElementById('th'+i);
                    if (th) th.innerHTML = th.innerText.replace(/\s*[‚ñ≤‚ñº]$/, '');
                }
                // Add arrow to sorted column
                let th = document.getElementById('th'+n);
                if (th) th.innerHTML = th.innerText + (asc ? ' ‚ñ≤' : ' ‚ñº');
            }
            </script>
            {% endblock %}
        </div>
    </div>
</body>
</html>
