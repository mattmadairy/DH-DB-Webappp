			<!-- Add Member Modal -->
			<div id="addMemberModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
				<div style="background-color:#f5f5f5; margin:4% auto; padding:20px; border:1px solid #888; width:420px; border-radius:8px; position:relative;">
					<button onclick="closeModal('addMemberModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
					<h3 style="margin-top:0; text-align:center;">Add Member</h3>
					<form id="addMemberForm">
						<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
						<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
							<label for="badge_number">Badge Number:</label><input type="text" id="badge_number" name="badge_number" required>
							<label for="membership_type">Membership Type:</label>
							<select id="membership_type" name="membership_type" required>
								<option value="Probationary">Probationary</option>
								<option value="Associate">Associate</option>
								<option value="Active">Active</option>
								<option value="Life">Life</option>
								<option value="Honorary">Honorary</option>
								<option value="Prospective">Prospective</option>
								<option value="Wait List">Wait List</option>
								<option value="Former">Former</option>
							</select>
							<label for="first_name">First Name:</label><input type="text" id="first_name" name="first_name" required>
							<label for="middle_name">Middle Name:</label><input type="text" id="middle_name" name="middle_name">
							<label for="last_name">Last Name:</label><input type="text" id="last_name" name="last_name" required>
							<label for="suffix">Suffix:</label><input type="text" id="suffix" name="suffix">
							<label for="nickname">Nickname:</label><input type="text" id="nickname" name="nickname">
							<label for="dob">Date of Birth:</label><input type="date" id="dob" name="dob">
							   <label for="email">Primary Email:</label>
							   <div style="display:flex; align-items:center; gap:4px;">
								   <input type="email" id="email" name="email">
								   <button type="button" onclick="copyEmail('email')" title="Copy Email" style="padding:2px 8px; font-size:1em; cursor:pointer;">üìã</button>
							   </div>
							   <label for="email2">Secondary Email:</label>
							   <div style="display:flex; align-items:center; gap:4px;">
								   <input type="email" id="email2" name="email2">
								   <button type="button" onclick="copyEmail('email2')" title="Copy Email" style="padding:2px 8px; font-size:1em; cursor:pointer;">üìã</button>
							   </div>
							<label for="phone">Primary Phone:</label><input type="text" id="phone" name="phone">
							<label for="phone2">Secondary Phone:</label><input type="text" id="phone2" name="phone2">
							<label for="address">Address:</label><input type="text" id="address" name="address">
							<label for="city">City:</label><input type="text" id="city" name="city">
							<label for="state">State:</label><input type="text" id="state" name="state">
							<label for="zip">Zip Code:</label><input type="text" id="zip" name="zip">
							<label for="join_date">Join Date:</label><input type="date" id="join_date" name="join_date">
							<label for="sponsor">Sponsor:</label><input type="text" id="sponsor" name="sponsor">
							<label for="card_internal">Card/Fob Internal Number:</label><input type="text" id="card_internal" name="card_internal">
							<label for="card_external">Card/Fob External Number:</label><input type="text" id="card_external" name="card_external">
						</div>
						<div style="margin-top:18px; text-align:center;">
							<button type="submit" style="padding:6px 18px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Add Member</button>
							<button type="button" onclick="closeModal('addMemberModal')" style="padding:6px 18px; border-radius:6px; border:1px solid #ccc; background:#f8f8f8; color:#333; cursor:pointer; margin-left:8px;">Cancel</button>
						</div>
					</form>
				</div>
			</div>
			<script>
			function openModal(id) {
				document.getElementById(id).style.display = 'block';
				document.getElementById(id).style.zIndex = 2000;
			}
			function closeModal(id) {
				document.getElementById(id).style.display = 'none';
			}
			document.getElementById('addMemberForm').onsubmit = function(e) {
				e.preventDefault();
				var form = document.getElementById('addMemberForm');
				var formData = new FormData(form);
				fetch('/add_member', {
					method: 'POST',
					body: formData
				}).then(response => response.json())
				  .then(function(data) {
					if (data.success) {
						alert('Member added successfully!');
						closeModal('addMemberModal');
						form.reset();
						window.location.reload();
					} else {
						alert('Error adding member: ' + (data.error || 'Unknown error'));
					}
				  });
			};
			</script>
<!-- Edit Work Hours Modal -->
	<div id="editWorkHoursModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('editWorkHoursModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="margin-top:0;">Edit Work Hours</h3>
			<form id="editWorkHoursForm">
				<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
				<input type="hidden" id="edit_wh_id" name="wh_id">
				<label for="edit_work_date">Date:</label><br>
				<input type="date" id="edit_work_date" name="work_date" required style="width:100%; margin-bottom:10px;"><br>
				<label for="edit_activity">Activity:</label><br>
				<select id="edit_activity" name="activity" required style="width:100%; margin-bottom:10px;">
					   {% for cname in committee_names|sort %}
						   <option value="{{ cname }}">{{ work_activity_display_names[cname] if work_activity_display_names and cname in work_activity_display_names else committee_display_names[cname] }}</option>
					   {% endfor %}
				</select><br>
				<label for="edit_work_hours">Hours:</label><br>
				<input type="number" id="edit_work_hours" name="work_hours" min="0" step="0.1" required style="width:100%; margin-bottom:10px;"><br>
				<label for="edit_notes">Notes:</label><br>
				<input type="text" id="edit_notes" name="notes" style="width:100%; margin-bottom:10px;"><br>
				<button type="submit" style="padding:6px 18px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Save</button>
				<button type="button" onclick="closeModal('editWorkHoursModal')" style="padding:6px 18px; border-radius:6px; border:1px solid #ccc; background:#f8f8f8; color:#333; cursor:pointer; margin-left:8px;">Cancel</button>
			</form>
		</div>
	</div>

	<script>
	function editWorkHours(id) {
		fetch('/get_work_hours/' + id)
			.then(response => response.json())
			.then(function(data) {
				document.getElementById('edit_wh_id').value = data.id;
				document.getElementById('edit_work_date').value = data.date;
				document.getElementById('edit_activity').value = data.activity;
				document.getElementById('edit_work_hours').value = data.hours;
				document.getElementById('edit_notes').value = data.notes;
				openModal('editWorkHoursModal');
			});
	}
	document.getElementById('editWorkHoursForm').onsubmit = function(e) {
		e.preventDefault();
		var id = document.getElementById('edit_wh_id').value;
		var date = document.getElementById('edit_work_date').value;
		var activity = document.getElementById('edit_activity').value;
		var hours = document.getElementById('edit_work_hours').value;
		var notes = document.getElementById('edit_notes').value;
		fetch('/edit_work_hours/' + id, {
			method: 'POST',
			headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
			body: 'date=' + encodeURIComponent(date) + '&activity=' + encodeURIComponent(activity) + '&hours=' + encodeURIComponent(hours) + '&notes=' + encodeURIComponent(notes)
		}).then(function(resp) {
			if (resp.ok) {
				location.reload();
			} else {
				alert('Failed to edit work hours');
			}
		});
	};

	function deleteWorkHours(id) {
		if (!confirm('Are you sure you want to delete this work hours entry?')) return;
		const formData = new FormData();
		formData.append('csrf_token', '{{ csrf_token() }}');
		fetch('/delete_work_hours/' + id, {
			method: 'POST',
			body: formData
		}).then(function(resp) {
			if (resp.ok) {
				location.reload();
			} else {
				alert('Failed to delete work hours');
			}
		});
	}
	</script>
<!DOCTYPE html>
<html>
<head>
    <title>Member Details - Dug Hill Rod & Gun Club</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='Main_Logo-removebg-preview.png') }}">
<script>
function showTab(event, tabName) {
	event.preventDefault();
	// Remove active from all tablinks
	document.querySelectorAll('.tablink').forEach(function(link) {
		link.classList.remove('active');
	});
	// Hide all tabcontent except modals
	document.querySelectorAll('.tabcontent').forEach(function(content) {
		content.classList.remove('active');
	});
	// Show selected tabcontent
	var selected = document.getElementById('tab-' + tabName);
	if (selected) {
		selected.classList.add('active');
	}
	// Set active tablink
	event.target.classList.add('active');
	// Save selected tab to localStorage
	localStorage.setItem('selectedTab', tabName);
}

// Restore selected tab on page load
document.addEventListener('DOMContentLoaded', function() {
	// If URL param tab=work_hours or tab=workhours, activate that tab
	var params = new URLSearchParams(window.location.search);
	var tabParam = params.get('tab');
	if (tabParam === 'work_hours' || tabParam === 'workhours') {
		var tablink = document.querySelector('.tablink[data-tab="workhours"]');
		if (tablink) tablink.click();
		return;
	}
	// If URL fragment is #workhours, activate that tab
	if (window.location.hash === '#workhours') {
		var tablink = document.querySelector('.tablink[data-tab="workhours"]');
		if (tablink) tablink.click();
		return;
	}
	var tabName = localStorage.getItem('selectedTab');
	if (tabName && document.getElementById('tab-' + tabName)) {
		// Find the tablink for this tab
		var tablink = document.querySelector('.tablink[data-tab="' + tabName + '"]');
		if (tablink) {
			tablink.click();
		}
	}
});

// Ensure modals are always visible above tabs
function openModal(id) {
	document.getElementById(id).style.display = 'block';
	document.getElementById(id).style.zIndex = 2000;
}

function toggleSubmenu() {
	var submenu = document.getElementById('reports-submenu');
	var arrow = document.getElementById('submenu-arrow');
	submenu.classList.toggle('active');
	arrow.textContent = submenu.classList.contains('active') ? '‚ñ≤' : '‚ñº';
}

function generateEmailList() {
	window.location.href = '{{ url_for("email_list") }}';
}
</script>
	<title>{{ member['first_name'] }} {{ member['last_name'] }} - Member Details</title>
	<link rel="icon" type="image/png" href="{{ url_for('static', filename='Main_Logo-removebg-preview.png') }}">
<style>
	.tabbar {
		display: flex;
		justify-content: center;
		margin-bottom: 32px;
	}
	.tablink {
		display: inline-block;
		min-width: 100px;
		padding: 8px 0;
		margin: 0 4px;
		border-radius: 6px;
		border: 1px solid #ccc;
		background-color: #f8f8f8;
		color: #333;
		text-decoration: none;
		font-weight: normal;
		box-shadow: 0 1px 2px rgba(0,0,0,0.04);
		cursor: pointer;
		text-align: center;
	}
	.tablink.active {
		background-color: rgb(255,255,0);
		font-weight: bold;
	}
	.tabcontent { display: none; }
	.tabcontent.active { display: block; }
	.submenu {
		display: none;
		flex-direction: column;
		margin-left: 10px;
	}
	.submenu.active {
		display: flex;
	}
	.submenu a {
		width: 160px !important;
		font-size: 0.9em !important;
		padding: 8px 0 !important;
		margin-bottom: 6px !important;
	}
	.menu-toggle {
		cursor: pointer;
		user-select: none;
	}
</style>
</head>
<body style="background-color:#384839; font-family:Arial, Helvetica, sans-serif;">
	<div style="display:flex; flex-direction:row;">
		<!-- Static Side Menu -->
		<div style="position:fixed; top:0; left:0; height:100vh; width:210px; background-color:#2c332b; display:flex; flex-direction:column; align-items:center; padding-top:120px; z-index:100; box-shadow:2px 0 8px rgba(0,0,0,0.08); overflow-y:auto;">
			<img src="{{ url_for('static', filename='Main_Logo-removebg-preview.png') }}" alt="Main Logo" style="height:143px; margin-top:-88px; margin-left:-8px; margin-bottom:34px;">
			<a href="{{ url_for('index') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üè† Home</a>
			<a href="javascript:void(0);" onclick="openModal('addMemberModal')" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">‚ûï Add Member</a>
			<a href="{{ url_for('recycle_bin') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üóëÔ∏è Recycle Bin</a>
			
			<div class="menu-toggle" onclick="toggleSubmenu()" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">
				üìä Reports <span id="submenu-arrow">‚ñº</span>
			</div>
			<div id="reports-submenu" class="submenu">
				<a href="{{ url_for('dues_report') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üíµ Dues</a>
				<a href="{{ url_for('work_hours_report') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">
					<img src="{{ url_for('static', filename='icon_work_hours.svg') }}" alt="Work Hours" style="height:1em; vertical-align:middle; margin-right:6px;"> Work Hours
				</a>
				<a href="{{ url_for('meeting_attendance_report') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">
					<img src="{{ url_for('static', filename='icon_attendance.svg') }}" alt="Attendance" style="height:1em; vertical-align:middle; margin-right:6px;"> Meeting Attendance
				</a>
				<a href="{{ url_for('kiosk_report') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üìã Kiosk</a>
			</div>
			
			<a href="{{ url_for('member_report', member_id=member['id']) }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">
				<span style="vertical-align:middle; margin-right:6px;">üìã</span> Member Report
			</a>
			<a href="{{ url_for('committees') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üë• Committees</a>
			<!-- Email List button removed -->
			<a href="{{ url_for('kiosk') }}" target="_blank" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üñ•Ô∏è Kiosk</a>
			{% if current_user.is_admin_or_bdfl() %}
			<a href="{{ url_for('admin_users') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#5bc0de; color:#ffffff; text-decoration:none; font-weight:bold; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üë§ Admin</a>
			{% endif %}
			<a href="{{ url_for('logout') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#d9534f; color:#ffffff; text-decoration:none; font-weight:bold; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üö™ Logout</a>
			{% if member_stats %}
			<div style="width:170px; margin-top:20px; padding:10px; border-top:1px solid #384839;">
				<div style="color:#f5f5f5; font-size:0.9em; line-height:1.6; text-align:left;">
					<div style="margin-bottom:8px;"><strong>Life:</strong> {{ member_stats.life_members }}</div>
					<div style="margin-bottom:8px;"><strong>Probationary, Associate, & Active:</strong> {{ member_stats.voting_members }}</div>
					<div style="border-top:1px solid #555; padding-top:8px;"><strong>Total:</strong> {{ member_stats.total_members }}</div>
				</div>
			</div>
			{% endif %}
		</div>
		<!-- Main content area shifted right to accommodate side menu -->
		<div style="flex:1; margin-left:210px; display:flex; flex-direction:column; align-items:center;">
			<div style="display:flex; flex-direction:row; align-items:center; justify-content:center; margin-bottom:0px; width:100%;">
				<div style="text-align:center; width:100%;">
					<h1 style="margin-bottom:0.2em; color:#f5f5f5; font-size:3em;">Dug Hill Rod & Gun Club</h1>
					<h1 style="margin-top:0.2em; color:#f5f5f5; font-size:3em;">Membership Database</h1>
				</div>
			</div>
			<h2 style="font-size:2.2em; margin-bottom:0.2em; margin-top:0; color:#f5f5f5; font-family:Arial, Helvetica, sans-serif; text-align:center; text-decoration:underline;">Member Details</h2>
			<!-- Removed extra space below page header -->
			<h3 style="margin-top:0; margin-bottom:0.2em; color:#f5f5f5; font-weight:normal; text-align:center; font-size:1.5em;">
				{% if position and position['position'] %}
					{{ position['position'] }}
				{% endif %}
				{{ member['first_name'] }} {{ member['last_name'] }}
				{% if member['badge_number'] %}
					(#{{ member['badge_number'] }})
				{% endif %}
			</h3>
			<div style="height:10px;"></div>
			
			<!-- Timeline for Prospective Members -->
			{% if member['membership_type'] == 'Prospective' %}
			<div style="width:100%; max-width:800px; margin:20px auto; padding:20px; background-color:#2c332b; border-radius:8px;">
				<div style="display:flex; justify-content:space-between; align-items:flex-start; position:relative;">
					<!-- Progress Line -->
					   <div style="position:absolute; top:20px; left:13%; width:77%; height:4px; background-color:#555; z-index:1;"></div>
					   {% set eligible = member.get('application_submitted') and member.get('introduced_date') and member.get('background_check_submitted') and member.get('background_check_passed') %}
					   <div style="position:absolute; top:20px; left:13%; width:{% if eligible %}77{% elif member.get('background_check_passed') %}62{% elif member.get('background_check_submitted') %}47{% elif member.get('introduced_date') %}32{% elif member.get('application_submitted') %}17{% else %}0{% endif %}%; height:4px; background-color:#5bc0de; z-index:2; transition:width 0.3s;"></div>
					
					<!-- Step 1: Application Received -->
					<div style="flex:1; text-align:center; position:relative; z-index:3;">
						<div style="width:40px; height:40px; margin:0 auto 10px; border-radius:50%; background-color:{{ '#5bc0de' if member.get('application_submitted') else '#555' }}; border:3px solid {{ '#fff' if member.get('application_submitted') else '#888' }}; display:flex; align-items:center; justify-content:center; font-size:1.2em; color:white; font-weight:bold;">1</div>
						<div style="color:#f5f5f5; font-size:0.9em; font-weight:bold; margin-bottom:5px;">Application<br>Received</div>
						<div style="color:{{ '#5bc0de' if member.get('application_submitted') else '#999' }}; font-size:0.8em;">{{ member['application_submitted']|format_mmddyyyy if member.get('application_submitted') else '‚Äî' }}</div>
					</div>
					
					<!-- Step 2: Introduced -->
					<div style="flex:1; text-align:center; position:relative; z-index:3;">
						<div style="width:40px; height:40px; margin:0 auto 10px; border-radius:50%; background-color:{{ '#5bc0de' if member.get('introduced_date') else '#555' }}; border:3px solid {{ '#fff' if member.get('introduced_date') else '#888' }}; display:flex; align-items:center; justify-content:center; font-size:1.2em; color:white; font-weight:bold;">2</div>
						<div style="color:#f5f5f5; font-size:0.9em; font-weight:bold; margin-bottom:5px;">Introduced</div>
						<div style="color:{{ '#5bc0de' if member.get('introduced_date') else '#999' }}; font-size:0.8em;">{{ member['introduced_date']|format_mmddyyyy if member.get('introduced_date') else '‚Äî' }}</div>
					</div>
					
					<!-- Step 3: Background Submitted -->
					<div style="flex:1; text-align:center; position:relative; z-index:3;">
						<div style="width:40px; height:40px; margin:0 auto 10px; border-radius:50%; background-color:{{ '#5bc0de' if member.get('background_check_submitted') else '#555' }}; border:3px solid {{ '#fff' if member.get('background_check_submitted') else '#888' }}; display:flex; align-items:center; justify-content:center; font-size:1.2em; color:white; font-weight:bold;">3</div>
						<div style="color:#f5f5f5; font-size:0.9em; font-weight:bold; margin-bottom:5px;">Background<br>Submitted</div>
						<div style="color:{{ '#5bc0de' if member.get('background_check_submitted') else '#999' }}; font-size:0.8em;">{{ member['background_check_submitted']|format_mmddyyyy if member.get('background_check_submitted') else '‚Äî' }}</div>
					</div>
					
					<!-- Step 4: Background Completed -->
					<div style="flex:1; text-align:center; position:relative; z-index:3;">
						<div style="width:40px; height:40px; margin:0 auto 10px; border-radius:50%; background-color:{{ '#5bc0de' if member.get('background_check_passed') else '#555' }}; border:3px solid {{ '#fff' if member.get('background_check_passed') else '#888' }}; display:flex; align-items:center; justify-content:center; font-size:1.2em; color:white; font-weight:bold;">4</div>
						<div style="color:#f5f5f5; font-size:0.9em; font-weight:bold; margin-bottom:5px;">Background<br>Completed</div>
						<div style="color:{{ '#5bc0de' if member.get('background_check_passed') else '#999' }}; font-size:0.8em;">{{ member['background_check_passed']|format_mmddyyyy if member.get('background_check_passed') else '‚Äî' }}</div>
					</div>
					
					   <!-- Step 5: Eligible -->
					   <div style="flex:1; text-align:center; position:relative; z-index:3;">
						   {% set eligible = member.get('application_submitted') and member.get('introduced_date') and member.get('background_check_submitted') and member.get('background_check_passed') %}
						   <div style="width:40px; height:40px; margin:0 auto 10px; border-radius:50%; background-color:{{ '#5bc0de' if eligible else '#555' }}; border:3px solid {{ '#fff' if eligible else '#888' }}; display:flex; align-items:center; justify-content:center; font-size:1.2em; color:white; font-weight:bold;">5</div>
						   <div style="color:#f5f5f5; font-size:0.9em; font-weight:bold; margin-bottom:5px;">Eligible</div>
						   <div style="color:{{ '#5bc0de' if eligible else '#999' }}; font-size:0.8em;">{% if eligible %}‚úî{% else %}‚Äî{% endif %}</div>
					   </div>
				</div>
			</div>
			{% endif %}
			
			<!-- Member Report button moved to sidebar -->
			<!-- Tabs Navigation -->
			<div class="tabbar" style="width:100%; max-width:700px; margin:auto; display:flex; align-items:center;">
				<a href="#" class="tablink active" data-tab="personal" onclick="showTab(event, 'personal')">Personal</a>
				<a href="#" class="tablink" data-tab="membership" onclick="showTab(event, 'membership')">Membership</a>
				<a href="#" class="tablink" data-tab="contact" onclick="showTab(event, 'contact')">Contact</a>
				<a href="#" class="tablink" data-tab="address" onclick="showTab(event, 'address')">Address</a>
				<a href="#" class="tablink" data-tab="dues" onclick="showTab(event, 'dues')">Dues</a>
				<a href="#" class="tablink" data-tab="workhours" onclick="showTab(event, 'workhours')">Work Hours</a>
				<a href="#" class="tablink" data-tab="meetings" onclick="showTab(event, 'meetings')">Meetings</a>
				<a href="#" class="tablink" data-tab="committees" onclick="showTab(event, 'committees')">Committees</a>
				<a href="{{ url_for('member_report', member_id=member['id']) }}" class="tablink" style="font-weight:normal;">Report</a>
			</div>
			<div style="height:24px;"></div>
		   <!-- Tab Content -->
		<div id="tab-personal" class="tabcontent active">
		   <!-- Personal Info Section -->
		   <table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			   <tr><th colspan="2" style="background:#f0f0f0; border:2px solid #222;">Personal Info</th></tr>
			   <tr><td style="border:2px solid #222;"><b>First Name:</b></td><td style="border:2px solid #222;">{{ member['first_name'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Middle Name:</b></td><td style="border:2px solid #222;">{{ member['middle_name'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Last Name:</b></td><td style="border:2px solid #222;">{{ member['last_name'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Suffix:</b></td><td style="border:2px solid #222;">{{ member['suffix'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Nickname:</b></td><td style="border:2px solid #222;">{{ member['nickname'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Date of Birth:</b></td><td style="border:2px solid #222;">{{ member['dob']|format_mmddyyyy }}</td></tr>
		   </table>
		   <div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			   <button onclick="openModal('personalModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Personal Info</button>
		   </div>
	   </div>
	<div id="tab-membership" class="tabcontent">
		   <!-- Membership Info Section -->
		   <table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			   <tr><th colspan="2" style="background:#f0f0f0; border:2px solid #222;">Membership Info</th></tr>
			   <tr><td style="border:2px solid #222;"><b>Badge Number:</b></td><td style="border:2px solid #222;">{{ member['badge_number'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Membership Type:</b></td><td style="border:2px solid #222;">{{ member['membership_type'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Application Submitted:</b></td><td style="border:2px solid #222;">{{ member['application_submitted']|format_mmddyyyy if member.get('application_submitted') else '' }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Introduced:</b></td><td style="border:2px solid #222;">{{ member['introduced_date']|format_mmddyyyy if member.get('introduced_date') else '' }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Background Check Submitted:</b></td><td style="border:2px solid #222;">{{ member['background_check_submitted']|format_mmddyyyy if member.get('background_check_submitted') else '' }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Background Check Passed:</b></td><td style="border:2px solid #222;">{{ member['background_check_passed']|format_mmddyyyy if member.get('background_check_passed') else '' }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Join Date:</b></td><td style="border:2px solid #222;">{{ member['join_date']|format_mmddyyyy }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Sponsor:</b></td><td style="border:2px solid #222;">{{ member['sponsor'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Card/Fob Internal Number:</b></td><td style="border:2px solid #222;">{{ member['card_internal'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Card/Fob External Number:</b></td><td style="border:2px solid #222;">{{ member['card_external'] }}</td></tr>
			   <tr>
				   <td style="border:2px solid #222;"><b>Executive Role:</b></td>
				   <td style="border:2px solid #222;">
					   {{ position['position'] if position else '' }}
					   {% if position and (position['term_start'] or position['term_end']) %}
						   <span style="font-style:italic; color:#444;">&nbsp;
							   {% if position['term_start'] and position['term_end'] %}
								   ({{ position['term_start']|format_mmddyyyy }} until {{ position['term_end']|format_mmddyyyy }})
							   {% elif position['term_start'] %}
								   ({{ position['term_start']|format_mmddyyyy }})
							   {% elif position['term_end'] %}
								   (until {{ position['term_end']|format_mmddyyyy }})
							   {% endif %}
						   </span>
					   {% endif %}
				   </td>
			   </tr>
			   <tr><td style="border:2px solid #222;"><b>Notes:</b></td><td style="border:2px solid #222; white-space:pre-wrap; word-wrap:break-word;">{{ member['member_notes'] if member['member_notes'] else '' }}</td></tr>
		   </table>
		   <div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			   <button onclick="openModal('membershipModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Membership Info</button>
		   </div>
	   </div>
	<div id="tab-contact" class="tabcontent">
		   <!-- Contact Info Section -->
		   <table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			   <tr><th colspan="2" style="background:#f0f0f0; border:2px solid #222;">Contact Info</th></tr>
			   <tr>
				   <td style="border:2px solid #222;"><b>Primary Email:</b></td>
				   <td style="border:2px solid #222;">
					   <div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
						   <span id="details-email">{{ member['email'] }}</span>
						   {% if member['email'] %}
						   <button type="button" onclick="copyEmailText('details-email')" title="Copy Email" style="padding:2px 8px; font-size:1em; cursor:pointer; margin-left:8px;">üìã</button>
						   {% endif %}
					   </div>
				   </td>
			   </tr>
			   <tr>
				   <td style="border:2px solid #222;"><b>Secondary Email:</b></td>
				   <td style="border:2px solid #222;">
					   <div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
						   <span id="details-email2">{{ member['email2'] }}</span>
						   {% if member['email2'] %}
						   <button type="button" onclick="copyEmailText('details-email2')" title="Copy Email" style="padding:2px 8px; font-size:1em; cursor:pointer; margin-left:8px;">üìã</button>
						   {% endif %}
					   </div>
				   </td>
			   </tr>
			</script>
			<script>
			function copyEmailText(spanId) {
				var span = document.getElementById(spanId);
				if (span) {
					var text = span.innerText || span.textContent;
					var tempInput = document.createElement('input');
					tempInput.value = text;
					document.body.appendChild(tempInput);
					tempInput.select();
					tempInput.setSelectionRange(0, 99999);
					document.execCommand('copy');
					document.body.removeChild(tempInput);
					alert('Email copied to clipboard!');
				}
			}
			</script>
			   <tr><td style="border:2px solid #222;"><b>Primary Phone:</b></td><td style="border:2px solid #222;">{{ member['phone'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Secondary Phone:</b></td><td style="border:2px solid #222;">{{ member['phone2'] }}</td></tr>
		   </table>
		   <div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			   <button onclick="openModal('contactModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Contact Info</button>
		   </div>
	   </div>
	<div id="tab-address" class="tabcontent">
		   <!-- Address Info Section -->
		   <table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			   <tr><th colspan="2" style="background:#f0f0f0; border:2px solid #222;">Address Info</th></tr>
			   <tr><td style="border:2px solid #222;"><b>Address:</b></td><td style="border:2px solid #222;">{{ member['address'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>City:</b></td><td style="border:2px solid #222;">{{ member['city'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>State:</b></td><td style="border:2px solid #222;">{{ member['state'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Zip Code:</b></td><td style="border:2px solid #222;">{{ member['zip'] }}</td></tr>
		   </table>
		   <div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			   <button onclick="openModal('addressModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Address Info</button>
		   </div>
	   </div>
	<div id="tab-dues" class="tabcontent">
		   <!-- Dues Section -->
           
		<table id="duesTable" border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			<tr>
			<th id="dues-sort-0" style="border:2px solid #222; cursor:pointer;" onclick="sortTable('duesTable', 0)">Year</th>
			<th id="dues-sort-1" style="border:2px solid #222; cursor:pointer;" onclick="sortTable('duesTable', 1)">Payment Date</th>
			<th id="dues-sort-2" style="border:2px solid #222; cursor:pointer;" onclick="sortTable('duesTable', 2)">Amount</th>
			<th id="dues-sort-3" style="border:2px solid #222; cursor:pointer;" onclick="sortTable('duesTable', 3)">Method</th>
			<th id="dues-sort-4" style="border:2px solid #222; cursor:pointer;" onclick="sortTable('duesTable', 4)">Notes</th>
			<!-- Email List button removed -->
			<th style="border:2px solid #222;">Actions</th>
			</tr>
			{% for due in dues %}
			<tr>
				<td style="border:2px solid #222;">{{ due['year'] }}</td>
				<td style="border:2px solid #222;">{{ due['payment_date']|format_mmddyyyy }}</td>
				<td style="border:2px solid #222;">${{ '%.2f'|format(due['amount']|float) }}</td>
				<td style="border:2px solid #222;">{{ due['method'] }}</td>
				<td style="border:2px solid #222;">{{ due['notes'] }}</td>
				<td style="text-align:center; background-color:#f5f5f5; border:2px solid #222;">
					<button type="button" onclick="editDue({{ due['id'] }})" style="padding:2px 10px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer; font-size:1em;">‚úèÔ∏è Edit</button>
					<button type="button" onclick="deleteDue({{ due['id'] }})" style="padding:2px 10px; border-radius:6px; border:1px solid #c00; background:#ffeaea; color:#c00; cursor:pointer; font-size:1em;">üóëÔ∏è Delete</button>
				</td>
			</tr>
			{% endfor %}
		</table>
		<div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			<button onclick="openModal('duesModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚ûï Add Dues Payment</button>
		</div>
	</div>

	<a id="workhours"></a>
	<div id="tab-workhours" class="tabcontent">
        
		<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			<tr><th>Date</th><th>Activity</th><th>Hours</th><th>Notes</th><th>Actions</th></tr>
			{% for wh in work_hours %}
			<tr>
				<td style="border:2px solid #222;">{{ wh['date']|format_mmddyyyy }}</td>
				<td style="border:2px solid #222;">{{ (work_activity_display_names[wh['activity']] if work_activity_display_names and wh['activity'] in work_activity_display_names else wh['activity']).replace('_', ' ').title() }}</td>
				<td style="border:2px solid #222;">{{ wh['hours'] }}</td>
				<td style="border:2px solid #222;">{{ wh['notes'] }}</td>
				<td style="text-align:center; background-color:#f5f5f5; border:2px solid #222;">
					<button type="button" onclick="editWorkHours({{ wh['id'] }})" style="padding:2px 10px; margin-right:6px; border-radius:4px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Edit</button>
					<button type="button" onclick="deleteWorkHours({{ wh['id'] }})" style="padding:2px 10px; border-radius:4px; border:1px solid #c00; background:#ffeaea; color:#c00; cursor:pointer;">Delete</button>
				</td>
			</tr>
			{% endfor %}
		</table>
		<div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			<button onclick="openModal('workHoursModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚ûï Add Work Hours</button>
		</div>
	</div>

	<div id="tab-meetings" class="tabcontent">
        
		<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			<tr><th>Date</th><th>Status</th><th>Actions</th></tr>
			{% for mtg in meetings %}
			<tr>
				<td style="border:2px solid #222;">{{ mtg['meeting_date']|format_mmddyyyy }}</td>
				<td style="border:2px solid #222;">{{ mtg['status'] }}</td>
				<td style="text-align:center; background-color:#f5f5f5; border:2px solid #222;">
					<button type="button" onclick="editMeeting({{ mtg['id'] }})" style="padding:2px 10px; margin-right:6px; border-radius:4px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Edit</button>
					<button type="button" onclick="deleteMeeting({{ mtg['id'] }})" style="padding:2px 10px; border-radius:4px; border:1px solid #c00; background:#ffeaea; color:#c00; cursor:pointer;">Delete</button>
				</td>
			</tr>
			{% endfor %}
		</table>
		<div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			<button onclick="openModal('addMeetingModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚ûï Add Meeting Attendance</button>
		</div>
	</div>

	<div id="tab-committees" class="tabcontent">
        
		<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			<tr><th>Committee</th><th>Member</th><th>Chair</th></tr>
			{% for cname in committee_names|sort %}
			<tr>
				<td style="border:2px solid #222;">{{ work_activity_display_names[cname] if work_activity_display_names and cname in work_activity_display_names else committee_display_names[cname] }}</td>
				   <td style="border:2px solid #222; text-align:center;">{% if committees[cname]|default('0') == 1 %}‚úîÔ∏è{% else %}‚Äî{% endif %}</td>
				   <td style="border:2px solid #222; text-align:center;">{% if committee_roles[cname] == 'chair' %}‚úîÔ∏è{% else %}‚Äî{% endif %}</td>
			</tr>
			{% endfor %}
		</table>
		<div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			<button onclick="openModal('editCommitteesModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Committees</button>
		</div>
	</div>
	</div>
		<!-- Committees Section only inside tab-committees tabcontent -->
	   </div>
		<div style="position:absolute; top:24px; left:32px; z-index:10;">
			<a href="{{ url_for('index') }}" style="display:inline-block; padding:8px 22px; border-radius:6px; border:1px solid #ccc; background-color:#f8f8f8; color:#333; text-decoration:none; font-weight:normal; box-shadow:0 1px 2px rgba(0,0,0,0.04);">üè† Home</a>
		</div>
	<!-- All main tables/sections are now inside their respective tabcontent divs above. Removed duplicate tables outside tabcontent. -->
	<!-- Work Hours Modal -->
	<div id="workHoursModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('workHoursModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="margin-top:0;">Add Work Hours</h3>
			<form id="addWorkHoursForm">
				<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
				<label for="work_date">Date:</label><br>
				<input type="date" id="work_date" name="work_date" required style="width:100%; margin-bottom:10px;"><br>
				<label for="work_activity">Activity:</label><br>
				<select id="work_activity" name="activity" required style="width:100%; margin-bottom:10px;">
					   {% for cname in committee_names|sort %}
						   <option value="{{ cname }}">{{ work_activity_display_names[cname] if work_activity_display_names and cname in work_activity_display_names else committee_display_names[cname] }}</option>
					   {% endfor %}
				</select><br>
				<label for="work_hours">Hours:</label><br>
				<input type="number" id="work_hours" name="work_hours" min="0" step="0.1" required style="width:100%; margin-bottom:10px;"><br>
				<label for="work_notes">Notes:</label><br>
				<input type="text" id="work_notes" name="notes" style="width:100%; margin-bottom:10px;"><br>
				<button type="submit" style="padding:6px 18px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Add</button>
				<button type="button" onclick="closeModal('workHoursModal')" style="padding:6px 18px; border-radius:6px; border:1px solid #ccc; background:#f8f8f8; color:#333; cursor:pointer; margin-left:8px;">Cancel</button>
			</form>
		</div>
	</div>

	<script>
	function openModal(id) {
		document.getElementById(id).style.display = 'block';
	}
	function closeModal(id) {
		document.getElementById(id).style.display = 'none';
	}
	document.getElementById('addWorkHoursForm').onsubmit = function(e) {
		e.preventDefault();
		var date = document.getElementById('work_date').value;
		var activity = document.getElementById('work_activity').value;
		var hours = document.getElementById('work_hours').value;
		var notes = document.getElementById('work_notes').value;
		fetch("/add_work_hours/{{ member['id'] }}", {
			method: "POST",
			headers: {"Content-Type": "application/x-www-form-urlencoded"},
			body: "date=" + encodeURIComponent(date) + "&activity=" + encodeURIComponent(activity) + "&hours=" + encodeURIComponent(hours) + "&notes=" + encodeURIComponent(notes)
		}).then(function(resp) {
			if (resp.ok) {
				location.reload();
			} else {
				alert('Failed to add work hours');
			}
		});
	};
	</script>
	<!-- Removed Dues and Meeting Attendance tables/headers outside tabcontent. These sections now only show in their respective tabs. -->
	<!-- Add Meeting Modal -->
	<div id="addMeetingModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('addMeetingModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="margin-top:0;">Add Meeting Attendance</h3>
			<form id="addMeetingForm">
				<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
				<label for="meeting_date">Date:</label><br>
				<input type="date" id="meeting_date" name="meeting_date" required style="width:100%; margin-bottom:10px;"><br>
				<label for="meeting_status">Status:</label><br>
				<select id="meeting_status" name="meeting_status" required style="width:100%; margin-bottom:10px;">
					<option value="Attended">Attended</option>
					<option value="Exempt">Exempt</option>
				</select><br>
				<button type="submit" style="padding:6px 18px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Add</button>
				<button type="button" onclick="closeModal('addMeetingModal')" style="padding:6px 18px; border-radius:6px; border:1px solid #ccc; background:#f8f8f8; color:#333; cursor:pointer; margin-left:8px;">Cancel</button>
			</form>
		</div>
	</div>

	<!-- Edit Meeting Modal -->
	<div id="editMeetingModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('editMeetingModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="margin-top:0;">Edit Meeting Attendance</h3>
			<form id="editMeetingForm">
				<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
				<input type="hidden" id="edit_meeting_id" name="meeting_id">
				<label for="edit_meeting_date">Date:</label><br>
				<input type="date" id="edit_meeting_date" name="meeting_date" required style="width:100%; margin-bottom:10px;"><br>
				<label for="edit_meeting_status">Status:</label><br>
				<select id="edit_meeting_status" name="meeting_status" required style="width:100%; margin-bottom:10px;">
					<option value="Attended">Attended</option>
					<option value="Exempt">Exempt</option>
				</select><br>
				<button type="submit" style="padding:6px 18px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Save</button>
				<button type="button" onclick="closeModal('editMeetingModal')" style="padding:6px 18px; border-radius:6px; border:1px solid #ccc; background:#f8f8f8; color:#333; cursor:pointer; margin-left:8px;">Cancel</button>
			</form>
		</div>
	</div>

	<script>
	document.getElementById('addMeetingForm').onsubmit = function(e) {
		e.preventDefault();
		var date = document.getElementById('meeting_date').value;
		var status = document.getElementById('meeting_status').value;
		fetch("/add_meeting_attendance/{{ member['id'] }}", {
			method: "POST",
			headers: {"Content-Type": "application/x-www-form-urlencoded"},
			body: "date=" + encodeURIComponent(date) + "&status=" + encodeURIComponent(status)
		}).then(function(resp) {
			if (resp.ok) {
				location.reload();
			} else {
				alert('Failed to add meeting attendance');
			}
		});
	};

	function editMeeting(id) {
		fetch('/get_meeting_attendance/' + id)
			.then(response => response.json())
			.then(data => {
				document.getElementById('edit_meeting_id').value = data.id;
				document.getElementById('edit_meeting_date').value = data.meeting_date;
					document.getElementById('edit_meeting_status').value = data.status;
				openModal('editMeetingModal');
			});
	}
	document.getElementById('editMeetingForm').onsubmit = function(e) {
		e.preventDefault();
		var id = document.getElementById('edit_meeting_id').value;
		var date = document.getElementById('edit_meeting_date').value;
		var status = document.getElementById('edit_meeting_status').value;
		fetch('/edit_meeting_attendance/' + id, {
			method: 'POST',
			headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
			body: 'date=' + encodeURIComponent(date) + '&status=' + encodeURIComponent(status)
		}).then(function(resp) {
			if (resp.ok) {
				location.reload();
			} else {
				alert('Failed to edit meeting attendance');
			}
		});
	};

	function deleteMeeting(id) {
		if (!confirm('Are you sure you want to delete this meeting attendance entry?')) return;
		const formData = new FormData();
		formData.append('csrf_token', '{{ csrf_token() }}');
		fetch('/delete_meeting_attendance/' + id, {
			method: 'POST',
			body: formData
		}).then(function(resp) {
			if (resp.ok) {
				location.reload();
			} else {
				alert('Failed to delete meeting attendance');
			}
		});
	}
	</script>
	<!-- Committees section removed from here; only inside tab-committees tabcontent. -->
<!-- Edit Committees Modal -->
<div id="editCommitteesModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
	<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
		<button onclick="closeModal('editCommitteesModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
		<h3 style="text-align:center;">Edit Committee Memberships</h3>
		<form id="editCommitteesForm">
			<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			   <div style="display:grid; grid-template-columns:1fr auto auto; gap:10px 12px; align-items:center;">
				   {% for cname in committee_names|sort %}
					   <label for="committee_{{ cname }}">{{ committee_display_names[cname] }}</label>
					   <input type="checkbox" id="committee_{{ cname }}" name="committee_{{ cname }}" value="1" {% if committees[cname]|default(0) == 1 %}checked{% endif %} style="justify-self:center;" onchange="toggleChairCheckbox('{{ cname }}')">
					   <input type="checkbox" id="chair_{{ cname }}" name="chair_{{ cname }}" value="1" {% if committee_roles[cname] == 'chair' %}checked{% endif %} style="justify-self:center;" {% if not (committees[cname]|default(0) == 1) %}disabled{% endif %}>
				   {% endfor %}
			</div>
			<div style="margin-top:18px; text-align:center;">
				<button type="button" onclick="submitCommittees()" style="margin-right:12px;">Save</button>
<script>
function toggleChairCheckbox(committeeName) {
	var memberCheckbox = document.getElementById('committee_' + committeeName);
	var chairCheckbox = document.getElementById('chair_' + committeeName);
	
	if (memberCheckbox.checked) {
		chairCheckbox.disabled = false;
	} else {
		chairCheckbox.disabled = true;
		chairCheckbox.checked = false;
	}
}

function submitCommittees() {
	var form = document.getElementById('editCommitteesForm');
	var formData = new FormData(form);
	var memberId = form.member_id.value;
	fetch(`/edit_section/${memberId}?section=committees`, {
		method: 'POST',
		body: formData
	}).then(function(resp) {
		if (resp.ok) {
			location.reload();
		} else {
			alert('Error saving committee changes');
		}
	});
}
</script>
				<button type="button" onclick="closeModal('editCommitteesModal')">Cancel</button>
			</div>
		</form>
	</div>
</div>
	</div>
<!-- Popup Modals for Editing Sections -->
<div id="personalModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('personalModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="text-align:center;">Edit Personal Info</h3>
		<form id="personalForm">
			<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="first_name">First Name:</label><input type="text" id="first_name" name="first_name" value="{{ member['first_name'] }}">
				<label for="middle_name">Middle Name:</label><input type="text" id="middle_name" name="middle_name" value="{{ member['middle_name'] }}">
				<label for="last_name">Last Name:</label><input type="text" id="last_name" name="last_name" value="{{ member['last_name'] }}">
				<label for="suffix">Suffix:</label><input type="text" id="suffix" name="suffix" value="{{ member['suffix'] }}">
				<label for="nickname">Nickname:</label><input type="text" id="nickname" name="nickname" value="{{ member['nickname'] }}">
		<label for="dob">Date of Birth:</label><input type="date" id="dob" name="dob" value="{{ member['dob'] }}">
			</div>
					<div style="margin-top:18px; text-align:center;">
						<button type="button" onclick="submitSection('personal')" style="margin-right:12px;">Save</button>
						<button type="button" onclick="closeModal('personalModal')">Cancel</button>
					</div>
		</form>
	</div>
</div>

<div id="membershipModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('membershipModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="text-align:center;">Edit Membership Info</h3>
		<form id="membershipForm">
			<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="badge_number">Badge Number:</label><input type="text" id="badge_number" name="badge_number" value="{{ member['badge_number'] }}">
				<label for="membership_type">Membership Type:</label>
				<select id="membership_type" name="membership_type">
					<option value="Probationary" {% if member['membership_type'] == 'Probationary' %}selected{% endif %}>Probationary</option>
					<option value="Associate" {% if member['membership_type'] == 'Associate' %}selected{% endif %}>Associate</option>
					<option value="Active" {% if member['membership_type'] == 'Active' %}selected{% endif %}>Active</option>
					<option value="Life" {% if member['membership_type'] == 'Life' %}selected{% endif %}>Life</option>
					<option value="Honorary" {% if member['membership_type'] == 'Honorary' %}selected{% endif %}>Honorary</option>
					<option value="Prospective" {% if member['membership_type'] == 'Prospective' %}selected{% endif %}>Prospective</option>
					<option value="Wait List" {% if member['membership_type'] == 'Wait List' %}selected{% endif %}>Wait List</option>
					<option value="Former" {% if member['membership_type'] == 'Former' %}selected{% endif %}>Former</option>
				</select>
				<label for="application_submitted">Application Submitted:</label><input type="date" id="application_submitted" name="application_submitted" value="{{ member['application_submitted'] if member.get('application_submitted') else '' }}">
				<label for="introduced_date">Introduced:</label><input type="date" id="introduced_date" name="introduced_date" value="{{ member['introduced_date'] if member.get('introduced_date') else '' }}">
				<label for="background_check_submitted">Background Check Submitted:</label><input type="date" id="background_check_submitted" name="background_check_submitted" value="{{ member['background_check_submitted'] if member.get('background_check_submitted') else '' }}">
				<label for="background_check_passed">Background Check Passed:</label><input type="date" id="background_check_passed" name="background_check_passed" value="{{ member['background_check_passed'] if member.get('background_check_passed') else '' }}">
				<label for="join_date">Join Date:</label><input type="date" id="join_date" name="join_date" value="{{ member['join_date'] }}">
				<label for="sponsor">Sponsor:</label><input type="text" id="sponsor" name="sponsor" value="{{ member['sponsor'] }}">
				<label for="card_internal">Card Internal:</label><input type="text" id="card_internal" name="card_internal" value="{{ member['card_internal'] }}">
				<label for="card_external">Card External:</label><input type="text" id="card_external" name="card_external" value="{{ member['card_external'] }}">
				<label for="position">Executive Role:</label>
				<select id="position" name="position" style="width:100%;">
					<option value="" {% if not position or not position['position'] %}selected{% endif %}></option>
					<option value="President" {% if position and position['position'] == 'President' %}selected{% endif %}>President</option>
					<option value="Vice President" {% if position and position['position'] == 'Vice President' %}selected{% endif %}>Vice President</option>
					<option value="Treasurer" {% if position and position['position'] == 'Treasurer' %}selected{% endif %}>Treasurer</option>
					<option value="Secretary" {% if position and position['position'] == 'Secretary' %}selected{% endif %}>Secretary</option>
					<option value="Trustee" {% if position and position['position'] == 'Trustee' %}selected{% endif %}>Trustee</option>
				</select>
				<label for="term_start">Term Start:</label><input type="date" id="term_start" name="term_start" value="{{ position['term_start'] if position and position['term_start'] else '' }}">
				<label for="term_end">Term End:</label><input type="date" id="term_end" name="term_end" value="{{ position['term_end'] if position and position['term_end'] else '' }}">
			</div>
			<div style="margin-top:12px;">
				<label for="member_notes" style="display:block; margin-bottom:5px; font-weight:bold;">Notes:</label>
				<textarea id="member_notes" name="member_notes" rows="5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-family:Arial, sans-serif; resize:vertical;">{{ member['member_notes'] if member['member_notes'] else '' }}</textarea>
			</div>
					<div style="margin-top:18px; text-align:center;">
						<button type="button" onclick="submitSection('membership')" style="margin-right:12px;">Save</button>
						<button type="button" onclick="closeModal('membershipModal')">Cancel</button>
					</div>
		</form>
	</div>
</div>

<div id="contactModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('contactModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="text-align:center;">Edit Contact Info</h3>
		<form id="contactForm" onsubmit="return validateAndSubmitContact(event);">
			<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				   <label for="contact_email">Primary Email:</label>
				   <div style="display:flex; align-items:center; gap:4px;">
					   <input type="email" id="contact_email" name="email" value="{{ member['email'] }}" pattern="[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}" title="Please include a valid email with domain extension (e.g., user@example.com)">
					   <button type="button" onclick="copyEmail('contact_email')" title="Copy Email" style="padding:2px 8px; font-size:1em; cursor:pointer;">üìã</button>
				   </div>
				   <label for="contact_email2">Secondary Email:</label>
				   <div style="display:flex; align-items:center; gap:4px;">
					   <input type="email" id="contact_email2" name="email2" value="{{ member['email2'] }}" pattern="[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}" title="Please include a valid email with domain extension (e.g., user@example.com)">
					   <button type="button" onclick="copyEmail('contact_email2')" title="Copy Email" style="padding:2px 8px; font-size:1em; cursor:pointer;">üìã</button>
				   </div>
				</script>
				<script>
				function copyEmail(inputId) {
					var input = document.getElementById(inputId);
					if (input) {
						input.select();
						input.setSelectionRange(0, 99999); // For mobile
						document.execCommand('copy');
						alert('Email copied to clipboard!');
					}
				}
				</script>
				<label for="contact_phone">Primary Phone:</label><input type="tel" id="contact_phone" name="phone" value="{{ member['phone'] }}" placeholder="(xxx) xxx-xxxx" oninput="formatPhoneNumber(this)" maxlength="14">
				<label for="contact_phone2">Secondary Phone:</label><input type="tel" id="contact_phone2" name="phone2" value="{{ member['phone2'] }}" placeholder="(xxx) xxx-xxxx" oninput="formatPhoneNumber(this)" maxlength="14">
			</div>
					<div style="margin-top:18px; text-align:center;">
						<button type="submit" style="margin-right:12px;">Save</button>
						<button type="button" onclick="closeModal('contactModal')">Cancel</button>
					</div>
		</form>
	</div>
</div>

<div id="addressModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('addressModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="text-align:center;">Edit Address Info</h3>
		<form id="addressForm">
			<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="address">Address:</label><input type="text" id="address" name="address" value="{{ member['address'] }}">
				<label for="city">City:</label><input type="text" id="city" name="city" value="{{ member['city'] }}">
				<label for="state">State:</label><input type="text" id="state" name="state" value="{{ member['state'] }}">
				<label for="zip">Zip Code:</label><input type="text" id="zip" name="zip" value="{{ member['zip'] }}">
			</div>
					<div style="margin-top:18px; text-align:center;">
						<button type="button" onclick="submitSection('address')" style="margin-right:12px;">Save</button>
						<button type="button" onclick="closeModal('addressModal')">Cancel</button>
					</div>
		</form>
	</div>
</div>

<div id="duesModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
	<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
		<button onclick="closeModal('duesModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
		<h3 style="text-align:center;">Add Dues Payment</h3>
		<form id="duesForm">
			<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="payment_date">Payment Date:</label><input type="date" id="payment_date" name="payment_date" value="" required>
				<label for="year">Year:</label><select id="year" name="year" required>
					{% for y in dues_years %}
					<option value="{{ y }}" {% if y == current_year %}selected{% endif %}>{{ y }}</option>
					{% endfor %}
				</select>
				<label for="amount">Amount:</label><input type="text" id="amount" name="amount" pattern="^\d+(\.\d{1,2})?$" title="Enter a valid amount (e.g., 50 or 50.00)" required>
				<label for="method">Method:</label><select id="method" name="method" required>
					<option value="">Select Method</option>
					<option value="Cash">Cash</option>
					<option value="Check">Check</option>
					<option value="Stripe">Stripe</option>
				</select>
				<label for="notes">Notes:</label><input type="text" id="notes" name="notes" value="">
			</div>
			<div style="margin-top:18px; text-align:center;">
				<button type="button" onclick="submitSection('dues')" style="margin-right:12px;">Save</button>
				<button type="button" onclick="closeModal('duesModal')">Cancel</button>
			</div>
		</form>
	</div>
</div>

<!-- Edit Dues Payment Modal -->
<div id="editDueModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
	<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
		<button onclick="closeModal('editDueModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
		<h3 style="text-align:center;">Edit Dues Payment</h3>
		<form id="editDueForm">
			<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
			<input type="hidden" name="due_id" id="edit_due_id" value="">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="edit_payment_date">Payment Date:</label><input type="date" id="edit_payment_date" name="payment_date" value="">
				<label for="edit_year">Year:</label><input type="text" id="edit_year" name="year" value="">
				<label for="edit_amount">Amount:</label><input type="number" id="edit_amount" name="amount" step="0.01">
				<label for="edit_method">Method:</label><input type="text" id="edit_method" name="method" value="">
				<label for="edit_due_notes">Notes:</label><input type="text" id="edit_due_notes" name="notes" value="">
			</div>
			<div style="margin-top:18px; text-align:center;">
				<button type="button" onclick="submitEditDue()" style="margin-right:12px;">Save</button>
				<button type="button" onclick="closeModal('editDueModal')">Cancel</button>
			</div>
		</form>
	</div>
</div>

<script>
function editDue(dueId) {
	fetch(`/get_due/${dueId}`)
		.then(response => response.json())
		.then(data => {
			if (data.error) {
				alert(data.error);
				return;
			}
			openModal('editDueModal');
			document.getElementById('edit_due_id').value = data.id;
			document.getElementById('edit_payment_date').value = data.payment_date;
			document.getElementById('edit_year').value = data.year;
			document.getElementById('edit_amount').value = parseFloat(data.amount).toFixed(2);
			document.getElementById('edit_method').value = data.method ? data.method : '';
			const notesField = document.getElementById('edit_due_notes');
			if (notesField) {
				notesField.value = data.notes;
				console.log('Notes field found, value set:', data.notes);
			} else {
				console.log('Notes field NOT found');
			}
		});
}

function submitEditDue() {
	var form = document.getElementById('editDueForm');
	var formData = new FormData(form);
	fetch(`/edit_due/${formData.get('due_id')}`, {
		method: 'POST',
		body: formData
	}).then(response => {
		if (response.ok) {
			location.reload();
		} else {
			alert('Error saving changes');
		}
	});
}

function deleteDue(dueId) {
	if (confirm('Are you sure you want to delete this dues payment?')) {
		const formData = new FormData();
		formData.append('csrf_token', '{{ csrf_token() }}');
		fetch(`/delete_due/${dueId}`, { 
			method: 'POST',
			body: formData
		})
			.then(response => {
				if (response.ok) {
					location.reload();
				} else {
					alert('Error deleting due');
				}
			});
	}
}

function openModal(id) {
	document.getElementById(id).style.display = 'block';
}

function closeModal(id) {
	document.getElementById(id).style.display = 'none';
}

function formatPhoneNumber(input) {
	// Remove all non-numeric characters
	let value = input.value.replace(/\D/g, '');
	
	// Limit to 10 digits
	value = value.substring(0, 10);
	
	// Format as (xxx) xxx-xxxx
	if (value.length >= 6) {
		input.value = '(' + value.substring(0, 3) + ') ' + value.substring(3, 6) + '-' + value.substring(6);
	} else if (value.length >= 3) {
		input.value = '(' + value.substring(0, 3) + ') ' + value.substring(3);
	} else if (value.length > 0) {
		input.value = '(' + value;
	}
}

function validateAndSubmitContact(event) {
	event.preventDefault();
	var form = document.getElementById('contactForm');
	
	// Validate email fields if they have content
	var email = document.getElementById('contact_email').value.trim();
	var email2 = document.getElementById('contact_email2').value.trim();
	
	if (email) {
		// Check if email has @ symbol and a dot after it
		var atIndex = email.indexOf('@');
		var lastDotIndex = email.lastIndexOf('.');
		if (atIndex === -1 || lastDotIndex === -1 || lastDotIndex <= atIndex + 1 || lastDotIndex === email.length - 1) {
			alert('Please enter a valid primary email with domain extension (e.g., user@example.com)');
			document.getElementById('contact_email').focus();
			return false;
		}
	}
	
	if (email2) {
		// Check if email has @ symbol and a dot after it
		var atIndex2 = email2.indexOf('@');
		var lastDotIndex2 = email2.lastIndexOf('.');
		if (atIndex2 === -1 || lastDotIndex2 === -1 || lastDotIndex2 <= atIndex2 + 1 || lastDotIndex2 === email2.length - 1) {
			alert('Please enter a valid secondary email with domain extension (e.g., user@example.com)');
			document.getElementById('contact_email2').focus();
			return false;
		}
	}
	
	// If validation passes, submit via AJAX
	submitSection('contact');
	return false;
}

function submitSection(section) {
	var formId = section === 'committees' ? 'editCommitteesForm' : section + 'Form';
	var form = document.getElementById(formId);
	
	// Check form validity
	if (!form.checkValidity()) {
		form.reportValidity();
		return;
	}
	
	var formData = new FormData(form);
	let url;
	if (section === 'committees') {
		url = `/edit_committees/${formData.get('member_id')}`;
	} else {
		url = `/edit_section/${formData.get('member_id')}?section=${section}`;
	}
	fetch(url, {
		method: 'POST',
		body: formData
	}).then(response => {
		if (response.ok) {
			location.reload();
		} else {
			alert('Error saving changes');
		}
	});
}

function sortTable(tableId, colIdx) {
    var table = document.getElementById(tableId);
    var rows = Array.from(table.rows).slice(1); // skip header
    var asc = table.getAttribute('data-sort-col') == colIdx && table.getAttribute('data-sort-dir') == 'asc' ? false : true;
    rows.sort(function(a, b) {
        var aText = a.cells[colIdx].innerText.trim();
        var bText = b.cells[colIdx].innerText.trim();
        // Numeric sort for Year and Amount
        if (colIdx === 0) {
            return asc ? (parseFloat(aText) - parseFloat(bText)) : (parseFloat(bText) - parseFloat(aText));
        }
        if (colIdx === 2) { // Amount column
            aText = aText.replace(/[^\d.\-]/g, '');
            bText = bText.replace(/[^\d.\-]/g, '');
            return asc ? (parseFloat(aText) - parseFloat(bText)) : (parseFloat(bText) - parseFloat(aText));
        }
        // Date sort for Payment Date
        if (colIdx === 1) {
            var aDate = Date.parse(aText);
            var bDate = Date.parse(bText);
            return asc ? (aDate - bDate) : (bDate - aDate);
        }
        // String sort for Method/Notes
        return asc ? aText.localeCompare(bText) : bText.localeCompare(aText);
    });
    // Remove old rows
    for (var i = 1; i < table.rows.length; i++) {
        table.deleteRow(1);
    }
    // Add sorted rows
    rows.forEach(function(row) {
        table.tBodies[0].appendChild(row);
    });
    table.setAttribute('data-sort-col', colIdx);
    table.setAttribute('data-sort-dir', asc ? 'asc' : 'desc');
    updateSortIcons(tableId, colIdx, asc);
}

function updateSortIcons(tableId, colIdx, asc) {
    for (let i = 0; i < 5; i++) {
        const th = document.getElementById('dues-sort-' + i);
        if (th) {
            th.textContent = th.textContent.replace(' ‚ñ≤', '').replace(' ‚ñº', '');
        }
    }
    const arrow = asc ? ' ‚ñ≤' : ' ‚ñº';
    const th = document.getElementById('dues-sort-' + colIdx);
    if (th) th.textContent = th.textContent + arrow;
}
</script>
