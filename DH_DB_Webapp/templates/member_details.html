<!DOCTYPE html>
<html>
<head>
	<title>{{ member['first_name'] }} {{ member['last_name'] }} - Member Details</title>
</head>
<body style="background-color:#384839; font-family:Arial, Helvetica, sans-serif;">
	<div style="display:flex; flex-direction:column; align-items:center;">
		<div style="display:flex; flex-direction:row; align-items:center; justify-content:center; margin-bottom:20px; width:100%;">
			<img src="{{ url_for('static', filename='Club_logo_smaller-removebg-preview.png') }}" alt="Club Logo Left" style="height:80px; margin-right:32px;">
			<div style="text-align:center;">
				<h1 style="margin-bottom:0.2em; color:#f5f5f5;">Dug Hill Rod & Gun Club</h1>
				<h1 style="margin-top:0.2em; color:#f5f5f5;">Membership Database</h1>
				<h2 style="margin-top:2em; margin-bottom:0em; color:#f5f5f5; font-weight:normal;">Member Details - {{ member['first_name'] }} {{ member['last_name'] }}</h2>
			</div>
			<img src="{{ url_for('static', filename='Club_logo_smaller-removebg-preview.png') }}" alt="Club Logo Right" style="height:80px; margin-left:32px;">
		</div>
	<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5;">
			<tr><th colspan="2" style="background:#f0f0f0;">Personal Info</th></tr>
			<tr><td><b>First Name:</b></td><td>{{ member['first_name'] }}</td></tr>
			<tr><td><b>Middle Name:</b></td><td>{{ member['middle_name'] }}</td></tr>
			<tr><td><b>Last Name:</b></td><td>{{ member['last_name'] }}</td></tr>
			<tr><td><b>Suffix:</b></td><td>{{ member['suffix'] }}</td></tr>
			<tr><td><b>Nickname:</b></td><td>{{ member['nickname'] }}</td></tr>
			<tr><td><b>Date of Birth:</b></td><td>{{ member['dob']|format_mmddyyyy }}</td></tr>
		</table>
		<div style="text-align:right; max-width:700px; margin:auto;">
			<button onclick="openModal('personalModal')" style="display:inline-block; padding:6px 18px; margin-top:8px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Personal Info</button>
		</div>
		<br>
		<div style="position:absolute; top:24px; left:32px; z-index:10;">
			<a href="{{ url_for('index') }}" style="display:inline-block; padding:8px 22px; border-radius:6px; border:1px solid #ccc; background-color:#f8f8f8; color:#333; text-decoration:none; font-weight:normal; box-shadow:0 1px 2px rgba(0,0,0,0.04);">üè† Home</a>
		</div>
	<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5;">
			<tr><th colspan="2" style="background:#f0f0f0;">Membership Info</th></tr>
			<tr><td><b>Badge Number:</b></td><td>{{ member['badge_number'] }}</td></tr>
			<tr><td><b>Membership Type:</b></td><td>{{ member['membership_type'] }}</td></tr>
			<tr><td><b>Join Date:</b></td><td>{{ member['join_date']|format_mmddyyyy }}</td></tr>
			<tr><td><b>Sponsor:</b></td><td>{{ member['sponsor'] }}</td></tr>
			<tr><td><b>Card/Fob Internal Number:</b></td><td>{{ member['card_internal'] }}</td></tr>
			<tr><td><b>Card/Fob External Number:</b></td><td>{{ member['card_external'] }}</td></tr>
		</table>
		<div style="text-align:right; max-width:700px; margin:auto;">
			<button onclick="openModal('membershipModal')" style="display:inline-block; padding:6px 18px; margin-top:8px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Membership Info</button>
		</div>
		<br>
	<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5;">
			<tr><th colspan="2" style="background:#f0f0f0;">Contact Info</th></tr>
			<tr><td><b>Primary Email:</b></td><td>{{ member['email'] }}</td></tr>
			<tr><td><b>Secondary Email:</b></td><td>{{ member['email2'] }}</td></tr>
			<tr><td><b>Primary Phone:</b></td><td>{{ member['phone'] }}</td></tr>
			<tr><td><b>Secondary Phone:</b></td><td>{{ member['phone2'] }}</td></tr>
		</table>
		<div style="text-align:right; max-width:700px; margin:auto;">
			<button onclick="openModal('contactModal')" style="display:inline-block; padding:6px 18px; margin-top:8px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Contact Info</button>
		</div>
		<br>
	<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5;">
			<tr><th colspan="2" style="background:#f0f0f0;">Address Info</th></tr>
			<tr><td><b>Address:</b></td><td>{{ member['address'] }}</td></tr>
			<tr><td><b>City:</b></td><td>{{ member['city'] }}</td></tr>
			<tr><td><b>State:</b></td><td>{{ member['state'] }}</td></tr>
			<tr><td><b>Zip Code:</b></td><td>{{ member['zip'] }}</td></tr>
		</table>
		<div style="text-align:right; max-width:700px; margin:auto;">
			<button onclick="openModal('addressModal')" style="display:inline-block; padding:6px 18px; margin-top:8px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Address Info</button>
		</div>
		<br>
	<h2 style="color:#f5f5f5;">Dues</h2>
	<div style="text-align:right; max-width:700px; margin:auto;">
	<button onclick="openModal('duesModal')" style="display:inline-block; padding:6px 18px; margin-bottom:8px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚ûï Add Dues Payment</button>
	</div>
		<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5;">
			<tr><th>Payment Date</th><th>Amount</th><th>Actions</th></tr>
			{% for due in dues %}
			<tr>
				<td>{{ due['payment_date']|format_mmddyyyy }}</td>
				<td>{{ '%.2f'|format(due['amount']) }}</td>
				<td style="text-align:center;">
					<button onclick="editDue({{ due['id'] }})" style="padding:2px 10px; margin-right:6px; border-radius:4px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Edit</button>
					<button onclick="deleteDue({{ due['id'] }})" style="padding:2px 10px; border-radius:4px; border:1px solid #c00; background:#ffeaea; color:#c00; cursor:pointer;">Delete</button>
				</td>
			</tr>
			{% endfor %}
		</table>
		<br>
	<h2 style="color:#f5f5f5;">Work Hours</h2>
		<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5;">
			<tr><th>Date</th><th>Hours</th></tr>
			{% for wh in work_hours %}
			<tr><td>{{ wh['date']|format_mmddyyyy }}</td><td>{{ wh['hours'] }}</td></tr>
			{% endfor %}
		</table>
		<br>
	<h2 style="color:#f5f5f5;">Meeting Attendance</h2>
		<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5;">
			<tr><th>Meeting Date</th><th>Attended</th></tr>
			{% for att in attendance %}
			<tr><td>{{ att['meeting_date']|format_mmddyyyy }}</td><td>{{ att['attended'] }}</td></tr>
			{% endfor %}
		</table>
		<br>
	<h2 style="color:#f5f5f5;">Role</h2>
		<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5;">
			<tr><th>Role</th></tr>
			<tr><td>{{ role['role'] if role else '' }}</td></tr>
		</table>
		<br>
	<h2 style="color:#f5f5f5;">Committees</h2>
		<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5;">
			<tr><th>Committee</th></tr>
			{% for key, value in committees.items() %}
			<tr><td>{{ key }}: {{ value }}</td></tr>
			{% endfor %}
		</table>
		<br>
		<a href="{{ url_for('index') }}">Back to Member List</a>
	</div>
<!-- Popup Modals for Editing Sections -->
<div id="personalModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px;">
			<h3 style="text-align:center;">Edit Personal Info</h3>
		<form id="personalForm">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="first_name">First Name:</label><input type="text" id="first_name" name="first_name" value="{{ member['first_name'] }}">
				<label for="middle_name">Middle Name:</label><input type="text" id="middle_name" name="middle_name" value="{{ member['middle_name'] }}">
				<label for="last_name">Last Name:</label><input type="text" id="last_name" name="last_name" value="{{ member['last_name'] }}">
				<label for="suffix">Suffix:</label><input type="text" id="suffix" name="suffix" value="{{ member['suffix'] }}">
				<label for="nickname">Nickname:</label><input type="text" id="nickname" name="nickname" value="{{ member['nickname'] }}">
		<label for="dob">Date of Birth:</label><input type="date" id="dob" name="dob" value="{{ member['dob'] }}">
			</div>
					<div style="margin-top:18px; text-align:center;">
						<button type="button" onclick="submitSection('personal')" style="margin-right:12px;">Save</button>
						<button type="button" onclick="closeModal('personalModal')">Cancel</button>
					</div>
		</form>
	</div>
</div>

<div id="membershipModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px;">
			<h3 style="text-align:center;">Edit Membership Info</h3>
		<form id="membershipForm">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="badge_number">Badge Number:</label><input type="text" id="badge_number" name="badge_number" value="{{ member['badge_number'] }}">
				<label for="membership_type">Membership Type:</label><input type="text" id="membership_type" name="membership_type" value="{{ member['membership_type'] }}">
		<label for="join_date">Join Date:</label><input type="date" id="join_date" name="join_date" value="{{ member['join_date'] }}">
				<label for="sponsor">Sponsor:</label><input type="text" id="sponsor" name="sponsor" value="{{ member['sponsor'] }}">
				<label for="card_internal">Card Internal:</label><input type="text" id="card_internal" name="card_internal" value="{{ member['card_internal'] }}">
				<label for="card_external">Card External:</label><input type="text" id="card_external" name="card_external" value="{{ member['card_external'] }}">
			</div>
					<div style="margin-top:18px; text-align:center;">
						<button type="button" onclick="submitSection('membership')" style="margin-right:12px;">Save</button>
						<button type="button" onclick="closeModal('membershipModal')">Cancel</button>
					</div>
		</form>
	</div>
</div>

<div id="contactModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px;">
			<h3 style="text-align:center;">Edit Contact Info</h3>
		<form id="contactForm">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="email">Primary Email:</label><input type="email" id="email" name="email" value="{{ member['email'] }}">
				<label for="email2">Secondary Email:</label><input type="email" id="email2" name="email2" value="{{ member['email2'] }}">
				<label for="phone">Primary Phone:</label><input type="text" id="phone" name="phone" value="{{ member['phone'] }}">
				<label for="phone2">Secondary Phone:</label><input type="text" id="phone2" name="phone2" value="{{ member['phone2'] }}">
			</div>
					<div style="margin-top:18px; text-align:center;">
						<button type="button" onclick="submitSection('contact')" style="margin-right:12px;">Save</button>
						<button type="button" onclick="closeModal('contactModal')">Cancel</button>
					</div>
		</form>
	</div>
</div>

<div id="addressModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px;">
			<h3 style="text-align:center;">Edit Address Info</h3>
		<form id="addressForm">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="address">Address:</label><input type="text" id="address" name="address" value="{{ member['address'] }}">
				<label for="city">City:</label><input type="text" id="city" name="city" value="{{ member['city'] }}">
				<label for="state">State:</label><input type="text" id="state" name="state" value="{{ member['state'] }}">
				<label for="zip">Zip Code:</label><input type="text" id="zip" name="zip" value="{{ member['zip'] }}">
			</div>
					<div style="margin-top:18px; text-align:center;">
						<button type="button" onclick="submitSection('address')" style="margin-right:12px;">Save</button>
						<button type="button" onclick="closeModal('addressModal')">Cancel</button>
					</div>
		</form>
	</div>
</div>

<div id="duesModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
	<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px;">
		<h3 style="text-align:center;">Add Dues Payment</h3>
		<form id="duesForm">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="payment_date">Payment Date:</label><input type="date" id="payment_date" name="payment_date" value="">
				<label for="amount">Amount:</label><input type="number" id="amount" name="amount" step="0.01">
			</div>
			<div style="margin-top:18px; text-align:center;">
				<button type="button" onclick="submitSection('dues')" style="margin-right:12px;">Save</button>
				<button type="button" onclick="closeModal('duesModal')">Cancel</button>
			</div>
		</form>
	</div>
</div>

<!-- Edit Dues Payment Modal -->
<div id="editDueModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
	<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px;">
		<h3 style="text-align:center;">Edit Dues Payment</h3>
		<form id="editDueForm">
			<input type="hidden" name="due_id" id="edit_due_id" value="">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="edit_payment_date">Payment Date:</label><input type="date" id="edit_payment_date" name="payment_date" value="">
				<label for="edit_amount">Amount:</label><input type="number" id="edit_amount" name="amount" step="0.01">
			</div>
			<div style="margin-top:18px; text-align:center;">
				<button type="button" onclick="submitEditDue()" style="margin-right:12px;">Save</button>
				<button type="button" onclick="closeModal('editDueModal')">Cancel</button>
			</div>
		</form>
	</div>
</div>

<script>
function editDue(dueId) {
	fetch(`/get_due/${dueId}`)
		.then(response => response.json())
		.then(data => {
			if (data.error) {
				alert(data.error);
				return;
			}
			document.getElementById('edit_due_id').value = data.id;
			document.getElementById('edit_payment_date').value = data.payment_date;
			document.getElementById('edit_amount').value = parseFloat(data.amount).toFixed(2);
			openModal('editDueModal');
		});
}

function submitEditDue() {
	var form = document.getElementById('editDueForm');
	var formData = new FormData(form);
	fetch(`/edit_due/${formData.get('due_id')}`, {
		method: 'POST',
		body: formData
	}).then(response => {
		if (response.ok) {
			location.reload();
		} else {
			alert('Error saving changes');
		}
	});
}

function deleteDue(dueId) {
	if (confirm('Are you sure you want to delete this dues payment?')) {
		fetch(`/delete_due/${dueId}`, { method: 'POST' })
			.then(response => {
				if (response.ok) {
					location.reload();
				} else {
					alert('Error deleting due');
				}
			});
	}
}

function openModal(id) {
	document.getElementById(id).style.display = 'block';
}

function closeModal(id) {
	document.getElementById(id).style.display = 'none';
}

function submitSection(section) {
	var form = document.getElementById(section + 'Form');
	var formData = new FormData(form);
	fetch(`/edit_section/${formData.get('member_id')}?section=${section}`, {
		method: 'POST',
		body: formData
	}).then(response => {
		if (response.ok) {
			location.reload();
		} else {
			alert('Error saving changes');
		}
	});
}
</script>
