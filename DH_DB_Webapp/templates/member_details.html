<!-- Edit Work Hours Modal -->
	<div id="editWorkHoursModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('editWorkHoursModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="margin-top:0;">Edit Work Hours</h3>
			<form id="editWorkHoursForm">
				<input type="hidden" id="edit_wh_id" name="wh_id">
				<label for="edit_work_date">Date:</label><br>
				<input type="date" id="edit_work_date" name="work_date" required style="width:100%; margin-bottom:10px;"><br>
				<label for="edit_activity">Activity:</label><br>
				<select id="edit_activity" name="activity" required style="width:100%; margin-bottom:10px;">
					   {% for cname in committee_names|sort %}
						   <option value="{{ cname }}">{{ work_activity_display_names[cname] if work_activity_display_names and cname in work_activity_display_names else committee_display_names[cname] }}</option>
					   {% endfor %}
				</select><br>
				<label for="edit_work_hours">Hours:</label><br>
				<input type="number" id="edit_work_hours" name="work_hours" min="0" step="0.1" required style="width:100%; margin-bottom:10px;"><br>
				<label for="edit_notes">Notes:</label><br>
				<input type="text" id="edit_notes" name="notes" style="width:100%; margin-bottom:10px;"><br>
				<button type="submit" style="padding:6px 18px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Save</button>
				<button type="button" onclick="closeModal('editWorkHoursModal')" style="padding:6px 18px; border-radius:6px; border:1px solid #ccc; background:#f8f8f8; color:#333; cursor:pointer; margin-left:8px;">Cancel</button>
			</form>
		</div>
	</div>

	<script>
	function editWorkHours(id) {
		fetch('/get_work_hours/' + id)
			.then(response => response.json())
			.then data => {
				document.getElementById('edit_wh_id').value = data.id;
				document.getElementById('edit_work_date').value = data.date;
				document.getElementById('edit_activity').value = data.activity;
				document.getElementById('edit_work_hours').value = data.hours;
				document.getElementById('edit_notes').value = data.notes;
				openModal('editWorkHoursModal');
			});
	}
	document.getElementById('editWorkHoursForm').onsubmit = function(e) {
		e.preventDefault();
		var id = document.getElementById('edit_wh_id').value;
		var date = document.getElementById('edit_work_date').value;
		var activity = document.getElementById('edit_activity').value;
		var hours = document.getElementById('edit_work_hours').value;
		var notes = document.getElementById('edit_notes').value;
		fetch('/edit_work_hours/' + id, {
			method: 'POST',
			headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
			body: 'date=' + encodeURIComponent(date) + '&activity=' + encodeURIComponent(activity) + '&hours=' + encodeURIComponent(hours) + '&notes=' + encodeURIComponent(notes)
		}).then(function(resp) {
			if (resp.ok) {
				location.reload();
			} else {
				alert('Failed to edit work hours');
			}
		});
	};

	function deleteWorkHours(id) {
		if (!confirm('Are you sure you want to delete this work hours entry?')) return;
		fetch('/delete_work_hours/' + id, {
			method: 'POST'
		}).then(function(resp) {
			if (resp.ok) {
				location.reload();
			} else {
				alert('Failed to delete work hours');
			}
		});
	}
	</script>
<!DOCTYPE html>
<html>
<head>
<script>
function showTab(event, tabName) {
	event.preventDefault();
	// Remove active from all tablinks
	document.querySelectorAll('.tablink').forEach(function(link) {
		link.classList.remove('active');
	});
	// Hide all tabcontent except modals
	document.querySelectorAll('.tabcontent').forEach(function(content) {
		content.classList.remove('active');
	});
	// Show selected tabcontent
	var selected = document.getElementById('tab-' + tabName);
	if (selected) {
		selected.classList.add('active');
	}
	// Set active tablink
	event.target.classList.add('active');
	// Save selected tab to localStorage
	localStorage.setItem('selectedTab', tabName);
}

// Restore selected tab on page load
document.addEventListener('DOMContentLoaded', function() {
	// If URL fragment is #workhours, activate that tab
	if (window.location.hash === '#workhours') {
		var tablink = document.querySelector('.tablink[data-tab="workhours"]');
		if (tablink) tablink.click();
		return;
	}
	var tabName = localStorage.getItem('selectedTab');
	if (tabName && document.getElementById('tab-' + tabName)) {
		// Find the tablink for this tab
		var tablink = document.querySelector('.tablink[data-tab="' + tabName + '"]');
		if (tablink) {
			tablink.click();
		}
	}
});

// Ensure modals are always visible above tabs
function openModal(id) {
	document.getElementById(id).style.display = 'block';
	document.getElementById(id).style.zIndex = 2000;
}
</script>
	<title>{{ member['first_name'] }} {{ member['last_name'] }} - Member Details</title>
<style>
	.tabbar {
		display: flex;
		justify-content: center;
		margin-bottom: 32px;
	}
	.tablink {
		display: inline-block;
		min-width: 100px;
		padding: 8px 0;
		margin: 0 4px;
		border-radius: 6px;
		border: 1px solid #ccc;
		background-color: #f8f8f8;
		color: #333;
		text-decoration: none;
		font-weight: normal;
		box-shadow: 0 1px 2px rgba(0,0,0,0.04);
		cursor: pointer;
		text-align: center;
	}
	.tablink.active {
		background-color: rgb(255,255,0);
		font-weight: bold;
	}
	.tabcontent { display: none; }
	.tabcontent.active { display: block; }
</style>
</head>
<body style="background-color:#384839; font-family:Arial, Helvetica, sans-serif;">
	<div style="display:flex; flex-direction:row;">
		<!-- Static Side Menu -->
		<div style="position:fixed; top:0; left:0; height:100vh; width:210px; background-color:#2c332b; display:flex; flex-direction:column; align-items:center; padding-top:120px; z-index:100; box-shadow:2px 0 8px rgba(0,0,0,0.08);">
			<img src="{{ url_for('static', filename='Main_Logo-removebg-preview.png') }}" alt="Main Logo" style="height:143px; margin-top:-88px; margin-left:-8px; margin-bottom:34px;">
			<a href="{{ url_for('index') }}" style="width:170px; display:inline-block; padding:8px 0; margin-bottom:18px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üè† Home</a>
			<a href="{{ url_for('member_report', member_id=member['id']) }}" style="width:170px; display:inline-block; padding:8px 0; margin-bottom:18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; text-decoration:none; font-weight:normal; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">ÔøΩ Member Report</a>
		</div>
		<!-- Main content area shifted right to accommodate side menu -->
		<div style="flex:1; margin-left:210px; display:flex; flex-direction:column; align-items:center;">
			<div style="display:flex; flex-direction:row; align-items:center; justify-content:center; margin-bottom:20px; width:100%;">
				<div style="text-align:center; width:100%;">
					<h1 style="margin-bottom:0.2em; color:#f5f5f5; font-size:3em;">Dug Hill Rod & Gun Club</h1>
					<h1 style="margin-top:0.2em; color:#f5f5f5; font-size:3em;">Membership Database</h1>
				</div>
			</div>
			<h2 style="margin-top:-0.7em; margin-bottom:0.2em; color:#f5f5f5; font-weight:normal; text-align:center; font-size:2em;">Member Details</h2>
			<div style="height:8px;"></div>
			<h3 style="margin-top:0; margin-bottom:0.2em; color:#f5f5f5; font-weight:normal; text-align:center; font-size:1.5em;">
				{% if position and position['position'] %}
					{{ position['position'] }}
				{% endif %}
				{{ member['first_name'] }} {{ member['last_name'] }}
				{% if member['badge_number'] %}
					(#{{ member['badge_number'] }})
				{% endif %}
			</h3>
			<div style="height:10px;"></div>
			<!-- Member Report button moved to sidebar -->
			<!-- Tabs Navigation -->
			<div class="tabbar" style="width:100%; max-width:700px; margin:auto;">
				<a href="#" class="tablink active" data-tab="personal" onclick="showTab(event, 'personal')">Personal</a>
				<a href="#" class="tablink" data-tab="membership" onclick="showTab(event, 'membership')">Membership</a>
				<a href="#" class="tablink" data-tab="contact" onclick="showTab(event, 'contact')">Contact</a>
				<a href="#" class="tablink" data-tab="address" onclick="showTab(event, 'address')">Address</a>
				<a href="#" class="tablink" data-tab="dues" onclick="showTab(event, 'dues')">Dues</a>
				<a href="#" class="tablink" data-tab="workhours" onclick="showTab(event, 'workhours')">Work Hours</a>
				<a href="#" class="tablink" data-tab="meetings" onclick="showTab(event, 'meetings')">Meetings</a>
				<a href="#" class="tablink" data-tab="committees" onclick="showTab(event, 'committees')">Committees</a>
			</div>
			<div style="height:24px;"></div>
		   <!-- Tab Content -->
		<div id="tab-personal" class="tabcontent active">
		   <!-- Personal Info Section -->
		   <table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			   <tr><th colspan="2" style="background:#f0f0f0; border:2px solid #222;">Personal Info</th></tr>
			   <tr><td style="border:2px solid #222;"><b>First Name:</b></td><td style="border:2px solid #222;">{{ member['first_name'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Middle Name:</b></td><td style="border:2px solid #222;">{{ member['middle_name'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Last Name:</b></td><td style="border:2px solid #222;">{{ member['last_name'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Suffix:</b></td><td style="border:2px solid #222;">{{ member['suffix'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Nickname:</b></td><td style="border:2px solid #222;">{{ member['nickname'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Date of Birth:</b></td><td style="border:2px solid #222;">{{ member['dob']|format_mmddyyyy }}</td></tr>
		   </table>
		   <div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			   <button onclick="openModal('personalModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Personal Info</button>
		   </div>
	   </div>
	<div id="tab-membership" class="tabcontent">
		   <!-- Membership Info Section -->
		   <table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			   <tr><th colspan="2" style="background:#f0f0f0; border:2px solid #222;">Membership Info</th></tr>
			   <tr><td style="border:2px solid #222;"><b>Badge Number:</b></td><td style="border:2px solid #222;">{{ member['badge_number'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Membership Type:</b></td><td style="border:2px solid #222;">{{ member['membership_type'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Join Date:</b></td><td style="border:2px solid #222;">{{ member['join_date']|format_mmddyyyy }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Sponsor:</b></td><td style="border:2px solid #222;">{{ member['sponsor'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Card/Fob Internal Number:</b></td><td style="border:2px solid #222;">{{ member['card_internal'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Card/Fob External Number:</b></td><td style="border:2px solid #222;">{{ member['card_external'] }}</td></tr>
			   <tr>
				   <td style="border:2px solid #222;"><b>Executive Role:</b></td>
				   <td style="border:2px solid #222;">
					   {{ position['position'] if position else '' }}
					   {% if position and (position['term_start'] or position['term_end']) %}
						   <span style="font-style:italic; color:#444;">&nbsp;
							   {% if position['term_start'] and position['term_end'] %}
								   ({{ position['term_start']|format_mmddyyyy }} until {{ position['term_end']|format_mmddyyyy }})
							   {% elif position['term_start'] %}
								   ({{ position['term_start']|format_mmddyyyy }})
							   {% elif position['term_end'] %}
								   (until {{ position['term_end']|format_mmddyyyy }})
							   {% endif %}
						   </span>
					   {% endif %}
				   </td>
			   </tr>
		   </table>
		   <div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			   <button onclick="openModal('membershipModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Membership Info</button>
		   </div>
	   </div>
	<div id="tab-contact" class="tabcontent">
		   <!-- Contact Info Section -->
		   <table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			   <tr><th colspan="2" style="background:#f0f0f0; border:2px solid #222;">Contact Info</th></tr>
			   <tr><td style="border:2px solid #222;"><b>Primary Email:</b></td><td style="border:2px solid #222;">{{ member['email'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Secondary Email:</b></td><td style="border:2px solid #222;">{{ member['email2'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Primary Phone:</b></td><td style="border:2px solid #222;">{{ member['phone'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Secondary Phone:</b></td><td style="border:2px solid #222;">{{ member['phone2'] }}</td></tr>
		   </table>
		   <div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			   <button onclick="openModal('contactModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Contact Info</button>
		   </div>
	   </div>
	<div id="tab-address" class="tabcontent">
		   <!-- Address Info Section -->
		   <table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			   <tr><th colspan="2" style="background:#f0f0f0; border:2px solid #222;">Address Info</th></tr>
			   <tr><td style="border:2px solid #222;"><b>Address:</b></td><td style="border:2px solid #222;">{{ member['address'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>City:</b></td><td style="border:2px solid #222;">{{ member['city'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>State:</b></td><td style="border:2px solid #222;">{{ member['state'] }}</td></tr>
			   <tr><td style="border:2px solid #222;"><b>Zip Code:</b></td><td style="border:2px solid #222;">{{ member['zip'] }}</td></tr>
		   </table>
		   <div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			   <button onclick="openModal('addressModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Address Info</button>
		   </div>
	   </div>
	<div id="tab-dues" class="tabcontent">
		   <!-- Dues Section -->
           
		<table id="duesTable" border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			<tr>
			<th id="dues-sort-0" style="border:2px solid #222; cursor:pointer;" onclick="sortTable('duesTable', 0)">Year</th>
			<th id="dues-sort-1" style="border:2px solid #222; cursor:pointer;" onclick="sortTable('duesTable', 1)">Payment Date</th>
			<th id="dues-sort-2" style="border:2px solid #222; cursor:pointer;" onclick="sortTable('duesTable', 2)">Amount</th>
			<th id="dues-sort-3" style="border:2px solid #222; cursor:pointer;" onclick="sortTable('duesTable', 3)">Method</th>
			<th id="dues-sort-4" style="border:2px solid #222; cursor:pointer;" onclick="sortTable('duesTable', 4)">Notes</th>

			<th style="border:2px solid #222;">Actions</th>
			</tr>
			{% for due in dues %}
			<tr>
				<td style="border:2px solid #222;">{{ due['year'] }}</td>
				<td style="border:2px solid #222;">{{ due['payment_date']|format_mmddyyyy }}</td>
				<td style="border:2px solid #222;">${{ '%.2f'|format(due['amount']) }}</td>
				<td style="border:2px solid #222;">{{ due['method'] }}</td>
				<td style="border:2px solid #222;">{{ due['notes'] }}</td>
				<td style="text-align:center; background-color:#f5f5f5; border:2px solid #222;">
					<button type="button" onclick="editDue({{ due['id'] }})" style="padding:2px 10px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer; font-size:1em;">‚úèÔ∏è Edit</button>
					<button type="button" onclick="deleteDue({{ due['id'] }})" style="padding:2px 10px; border-radius:6px; border:1px solid #c00; background:#ffeaea; color:#c00; cursor:pointer; font-size:1em;">üóëÔ∏è Delete</button>
				</td>
			</tr>
			{% endfor %}
		</table>
		<div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			<button onclick="openModal('duesModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚ûï Add Dues Payment</button>
		</div>
	</div>

	<a id="workhours"></a>
	<div id="tab-workhours" class="tabcontent">
        
		<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			<tr><th>Date</th><th>Activity</th><th>Hours</th><th>Notes</th><th>Actions</th></tr>
			{% for wh in work_hours %}
			<tr>
				<td style="border:2px solid #222;">{{ wh['date']|format_mmddyyyy }}</td>
				<td style="border:2px solid #222;">{{ (work_activity_display_names[wh['activity']] if work_activity_display_names and wh['activity'] in work_activity_display_names else wh['activity']).replace('_', ' ').title() }}</td>
				<td style="border:2px solid #222;">{{ wh['hours'] }}</td>
				<td style="border:2px solid #222;">{{ wh['notes'] }}</td>
				<td style="text-align:center; background-color:#f5f5f5; border:2px solid #222;">
					<button type="button" onclick="editWorkHours({{ wh['id'] }})" style="padding:2px 10px; margin-right:6px; border-radius:4px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Edit</button>
					<button type="button" onclick="deleteWorkHours({{ wh['id'] }})" style="padding:2px 10px; border-radius:4px; border:1px solid #c00; background:#ffeaea; color:#c00; cursor:pointer;">Delete</button>
				</td>
			</tr>
			{% endfor %}
		</table>
		<div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			<button onclick="openModal('workHoursModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚ûï Add Work Hours</button>
		</div>
	</div>

	<div id="tab-meetings" class="tabcontent">
        
		<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			<tr><th>Date</th><th>Status</th><th>Actions</th></tr>
			{% for mtg in meetings %}
			<tr>
				<td style="border:2px solid #222;">{{ mtg['meeting_date']|format_mmddyyyy }}</td>
				<td style="border:2px solid #222;">{{ mtg['status'] }}</td>
				<td style="text-align:center; background-color:#f5f5f5; border:2px solid #222;">
					<button type="button" onclick="editMeeting({{ mtg['id'] }})" style="padding:2px 10px; margin-right:6px; border-radius:4px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Edit</button>
					<button type="button" onclick="deleteMeeting({{ mtg['id'] }})" style="padding:2px 10px; border-radius:4px; border:1px solid #c00; background:#ffeaea; color:#c00; cursor:pointer;">Delete</button>
				</td>
			</tr>
			{% endfor %}
		</table>
		<div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			<button onclick="openModal('addMeetingModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚ûï Add Meeting Attendance</button>
		</div>
	</div>

	<div id="tab-committees" class="tabcontent">
        
		<table border="1" cellpadding="6" cellspacing="0" style="margin:auto; width:100%; max-width:700px; table-layout:fixed; background-color:#f5f5f5; border-collapse:collapse; border:2px solid #222;">
			<tr><th>Committee</th><th>Member?</th></tr>
			{% for cname in committee_names|sort %}
			<tr>
				<td style="border:2px solid #222;">{{ work_activity_display_names[cname] if work_activity_display_names and cname in work_activity_display_names else committee_display_names[cname] }}</td>
				<td style="border:2px solid #222; text-align:center;">{% if committees[cname]|default(0) == 1 %}‚úîÔ∏è{% else %}‚Äî{% endif %}</td>
			</tr>
			{% endfor %}
		</table>
		<div style="display:flex; justify-content:center; align-items:center; margin-top:16px;">
			<button onclick="openModal('editCommitteesModal')" style="display:inline-block; padding:6px 18px; border-radius:6px; border:1px solid #384839; background-color:#f8f8f8; color:#384839; font-weight:normal; cursor:pointer;">‚úèÔ∏è Edit Committees</button>
		</div>
	</div>
	</div>
		<!-- Committees Section only inside tab-committees tabcontent -->
	   </div>
		<div style="position:absolute; top:24px; left:32px; z-index:10;">
			<a href="{{ url_for('index') }}" style="display:inline-block; padding:8px 22px; border-radius:6px; border:1px solid #ccc; background-color:#f8f8f8; color:#333; text-decoration:none; font-weight:normal; box-shadow:0 1px 2px rgba(0,0,0,0.04);">üè† Home</a>
		</div>
	<!-- All main tables/sections are now inside their respective tabcontent divs above. Removed duplicate tables outside tabcontent. -->
	<!-- Work Hours Modal -->
	<div id="workHoursModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('workHoursModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="margin-top:0;">Add Work Hours</h3>
			<form id="addWorkHoursForm">
				<label for="work_date">Date:</label><br>
				<input type="date" id="work_date" name="work_date" required style="width:100%; margin-bottom:10px;"><br>
				<label for="work_activity">Activity:</label><br>
				<select id="work_activity" name="activity" required style="width:100%; margin-bottom:10px;">
					   {% for cname in committee_names|sort %}
						   <option value="{{ cname }}">{{ work_activity_display_names[cname] if work_activity_display_names and cname in work_activity_display_names else committee_display_names[cname] }}</option>
					   {% endfor %}
				</select><br>
				<label for="work_hours">Hours:</label><br>
				<input type="number" id="work_hours" name="work_hours" min="0" step="0.1" required style="width:100%; margin-bottom:10px;"><br>
				<label for="work_notes">Notes:</label><br>
				<input type="text" id="work_notes" name="notes" style="width:100%; margin-bottom:10px;"><br>
				<button type="submit" style="padding:6px 18px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Add</button>
				<button type="button" onclick="closeModal('workHoursModal')" style="padding:6px 18px; border-radius:6px; border:1px solid #ccc; background:#f8f8f8; color:#333; cursor:pointer; margin-left:8px;">Cancel</button>
			</form>
		</div>
	</div>

	<script>
	function openModal(id) {
		document.getElementById(id).style.display = 'block';
	}
	function closeModal(id) {
		document.getElementById(id).style.display = 'none';
	}
	document.getElementById('addWorkHoursForm').onsubmit = function(e) {
		e.preventDefault();
		var date = document.getElementById('work_date').value;
		var activity = document.getElementById('work_activity').value;
		var hours = document.getElementById('work_hours').value;
		var notes = document.getElementById('work_notes').value;
		fetch("/add_work_hours/{{ member['id'] }}", {
			method: "POST",
			headers: {"Content-Type": "application/x-www-form-urlencoded"},
			body: "date=" + encodeURIComponent(date) + "&activity=" + encodeURIComponent(activity) + "&hours=" + encodeURIComponent(hours) + "&notes=" + encodeURIComponent(notes)
		}).then(function(resp) {
			if (resp.ok) {
				location.reload();
			} else {
				alert('Failed to add work hours');
			}
		});
	};
	</script>
	<!-- Removed Dues and Meeting Attendance tables/headers outside tabcontent. These sections now only show in their respective tabs. -->
	<!-- Add Meeting Modal -->
	<div id="addMeetingModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('addMeetingModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="margin-top:0;">Add Meeting Attendance</h3>
			<form id="addMeetingForm">
				<label for="meeting_date">Date:</label><br>
				<input type="date" id="meeting_date" name="meeting_date" required style="width:100%; margin-bottom:10px;"><br>
				<label for="meeting_status">Status:</label><br>
				<select id="meeting_status" name="meeting_status" required style="width:100%; margin-bottom:10px;">
					<option value="Attended">Attended</option>
					<option value="Exempt">Exempt</option>
				</select><br>
				<button type="submit" style="padding:6px 18px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Add</button>
				<button type="button" onclick="closeModal('addMeetingModal')" style="padding:6px 18px; border-radius:6px; border:1px solid #ccc; background:#f8f8f8; color:#333; cursor:pointer; margin-left:8px;">Cancel</button>
			</form>
		</div>
	</div>

	<!-- Edit Meeting Modal -->
	<div id="editMeetingModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('editMeetingModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="margin-top:0;">Edit Meeting Attendance</h3>
			<form id="editMeetingForm">
				<input type="hidden" id="edit_meeting_id" name="meeting_id">
				<label for="edit_meeting_date">Date:</label><br>
				<input type="date" id="edit_meeting_date" name="meeting_date" required style="width:100%; margin-bottom:10px;"><br>
				<label for="edit_meeting_status">Status:</label><br>
				<select id="edit_meeting_status" name="meeting_status" required style="width:100%; margin-bottom:10px;">
					<option value="Attended">Attended</option>
					<option value="Exempt">Exempt</option>
				</select><br>
				<button type="submit" style="padding:6px 18px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Save</button>
				<button type="button" onclick="closeModal('editMeetingModal')" style="padding:6px 18px; border-radius:6px; border:1px solid #ccc; background:#f8f8f8; color:#333; cursor:pointer; margin-left:8px;">Cancel</button>
			</form>
		</div>
	</div>

	<script>
	document.getElementById('addMeetingForm').onsubmit = function(e) {
		e.preventDefault();
		var date = document.getElementById('meeting_date').value;
		var status = document.getElementById('meeting_status').value;
		fetch("/add_meeting_attendance/{{ member['id'] }}", {
			method: "POST",
			headers: {"Content-Type": "application/x-www-form-urlencoded"},
			body: "date=" + encodeURIComponent(date) + "&status=" + encodeURIComponent(status)
		}).then(function(resp) {
			if (resp.ok) {
				location.reload();
			} else {
				alert('Failed to add meeting attendance');
			}
		});
	};

	function editMeeting(id) {
		fetch('/get_meeting_attendance/' + id)
			.then(response => response.json())
			.then(data => {
				document.getElementById('edit_meeting_id').value = data.id;
				document.getElementById('edit_meeting_date').value = data.meeting_date;
					document.getElementById('edit_meeting_status').value = data.status;
				openModal('editMeetingModal');
			});
	}
	document.getElementById('editMeetingForm').onsubmit = function(e) {
		e.preventDefault();
		var id = document.getElementById('edit_meeting_id').value;
		var date = document.getElementById('edit_meeting_date').value;
		var status = document.getElementById('edit_meeting_status').value;
		fetch('/edit_meeting_attendance/' + id, {
			method: 'POST',
			headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
			body: 'date=' + encodeURIComponent(date) + '&status=' + encodeURIComponent(status)
		}).then(function(resp) {
			if (resp.ok) {
				location.reload();
			} else {
				alert('Failed to edit meeting attendance');
			}
		});
	};

	function deleteMeeting(id) {
		if (!confirm('Are you sure you want to delete this meeting attendance entry?')) return;
		fetch('/delete_meeting_attendance/' + id, {
			method: 'POST'
		}).then(function(resp) {
			if (resp.ok) {
				location.reload();
			} else {
				alert('Failed to delete meeting attendance');
			}
		});
	}
	</script>
	<!-- Committees section removed from here; only inside tab-committees tabcontent. -->
<!-- Edit Committees Modal -->
<div id="editCommitteesModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
	<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
		<button onclick="closeModal('editCommitteesModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
		<h3 style="text-align:center;">Edit Committee Memberships</h3>
		<form id="editCommitteesForm">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:1fr 1fr; gap:10px 12px; align-items:center;">
				{% for cname in committee_names|sort %}
					<label for="committee_{{ cname }}">{{ committee_display_names[cname] }}</label>
					<input type="checkbox" id="committee_{{ cname }}" name="committee_{{ cname }}" value="1" {% if committees[cname]|default(0) == 1 %}checked{% endif %}>
				{% endfor %}
			</div>
			<div style="margin-top:18px; text-align:center;">
				<button type="button" onclick="submitCommittees()" style="margin-right:12px;">Save</button>
<script>
function submitCommittees() {
	var form = document.getElementById('editCommitteesForm');
	var formData = new FormData(form);
	var memberId = form.member_id.value;
	fetch(`/edit_section/${memberId}?section=committees`, {
		method: 'POST',
		body: formData
	}).then(function(resp) {
		if (resp.ok) {
			location.reload();
		} else {
			alert('Error saving committee changes');
		}
	});
}
</script>
				<button type="button" onclick="closeModal('editCommitteesModal')">Cancel</button>
			</div>
		</form>
	</div>
</div>
	</div>
<!-- Popup Modals for Editing Sections -->
<div id="personalModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('personalModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="text-align:center;">Edit Personal Info</h3>
		<form id="personalForm">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="first_name">First Name:</label><input type="text" id="first_name" name="first_name" value="{{ member['first_name'] }}">
				<label for="middle_name">Middle Name:</label><input type="text" id="middle_name" name="middle_name" value="{{ member['middle_name'] }}">
				<label for="last_name">Last Name:</label><input type="text" id="last_name" name="last_name" value="{{ member['last_name'] }}">
				<label for="suffix">Suffix:</label><input type="text" id="suffix" name="suffix" value="{{ member['suffix'] }}">
				<label for="nickname">Nickname:</label><input type="text" id="nickname" name="nickname" value="{{ member['nickname'] }}">
		<label for="dob">Date of Birth:</label><input type="date" id="dob" name="dob" value="{{ member['dob'] }}">
			</div>
					<div style="margin-top:18px; text-align:center;">
						<button type="button" onclick="submitSection('personal')" style="margin-right:12px;">Save</button>
						<button type="button" onclick="closeModal('personalModal')">Cancel</button>
					</div>
		</form>
	</div>
</div>

<div id="membershipModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('membershipModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="text-align:center;">Edit Membership Info</h3>
		<form id="membershipForm">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="badge_number">Badge Number:</label><input type="text" id="badge_number" name="badge_number" value="{{ member['badge_number'] }}">
				<label for="membership_type">Membership Type:</label><input type="text" id="membership_type" name="membership_type" value="{{ member['membership_type'] }}">
				<label for="join_date">Join Date:</label><input type="date" id="join_date" name="join_date" value="{{ member['join_date'] }}">
				<label for="sponsor">Sponsor:</label><input type="text" id="sponsor" name="sponsor" value="{{ member['sponsor'] }}">
				<label for="card_internal">Card Internal:</label><input type="text" id="card_internal" name="card_internal" value="{{ member['card_internal'] }}">
				<label for="card_external">Card External:</label><input type="text" id="card_external" name="card_external" value="{{ member['card_external'] }}">
				<label for="position">Executive Role:</label>
				<select id="position" name="position" style="width:100%;">
					<option value="" {% if not position or not position['position'] %}selected{% endif %}></option>
					<option value="President" {% if position and position['position'] == 'President' %}selected{% endif %}>President</option>
					<option value="Vice President" {% if position and position['position'] == 'Vice President' %}selected{% endif %}>Vice President</option>
					<option value="Treasurer" {% if position and position['position'] == 'Treasurer' %}selected{% endif %}>Treasurer</option>
					<option value="Secretary" {% if position and position['position'] == 'Secretary' %}selected{% endif %}>Secretary</option>
					<option value="Trustee" {% if position and position['position'] == 'Trustee' %}selected{% endif %}>Trustee</option>
				</select>
				<label for="term_start">Term Start:</label><input type="date" id="term_start" name="term_start" value="{{ position['term_start'] if position and position['term_start'] else '' }}">
				<label for="term_end">Term End:</label><input type="date" id="term_end" name="term_end" value="{{ position['term_end'] if position and position['term_end'] else '' }}">
			</div>
					<div style="margin-top:18px; text-align:center;">
						<button type="button" onclick="submitSection('membership')" style="margin-right:12px;">Save</button>
						<button type="button" onclick="closeModal('membershipModal')">Cancel</button>
					</div>
		</form>
	</div>
</div>

<div id="contactModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('contactModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="text-align:center;">Edit Contact Info</h3>
		<form id="contactForm">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="email">Primary Email:</label><input type="email" id="email" name="email" value="{{ member['email'] }}">
				<label for="email2">Secondary Email:</label><input type="email" id="email2" name="email2" value="{{ member['email2'] }}">
				<label for="phone">Primary Phone:</label><input type="text" id="phone" name="phone" value="{{ member['phone'] }}">
				<label for="phone2">Secondary Phone:</label><input type="text" id="phone2" name="phone2" value="{{ member['phone2'] }}">
			</div>
					<div style="margin-top:18px; text-align:center;">
						<button type="button" onclick="submitSection('contact')" style="margin-right:12px;">Save</button>
						<button type="button" onclick="closeModal('contactModal')">Cancel</button>
					</div>
		</form>
	</div>
</div>

<div id="addressModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
		<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
			<button onclick="closeModal('addressModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
			<h3 style="text-align:center;">Edit Address Info</h3>
		<form id="addressForm">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="address">Address:</label><input type="text" id="address" name="address" value="{{ member['address'] }}">
				<label for="city">City:</label><input type="text" id="city" name="city" value="{{ member['city'] }}">
				<label for="state">State:</label><input type="text" id="state" name="state" value="{{ member['state'] }}">
				<label for="zip">Zip Code:</label><input type="text" id="zip" name="zip" value="{{ member['zip'] }}">
			</div>
					<div style="margin-top:18px; text-align:center;">
						<button type="button" onclick="submitSection('address')" style="margin-right:12px;">Save</button>
						<button type="button" onclick="closeModal('addressModal')">Cancel</button>
					</div>
		</form>
	</div>
</div>

<div id="duesModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
	<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
		<button onclick="closeModal('duesModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
		<h3 style="text-align:center;">Add Dues Payment</h3>
		<form id="duesForm">
			<input type="hidden" name="member_id" value="{{ member['id'] }}">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="payment_date">Payment Date:</label><input type="date" id="payment_date" name="payment_date" value="">
				<label for="year">Year:</label><input type="text" id="year" name="year" value="{{ selected_year if selected_year else current_year }}">
				<label for="amount">Amount:</label><input type="number" id="amount" name="amount" step="0.01">
				<label for="method">Method:</label><input type="text" id="method" name="method" value="">
				<label for="notes">Notes:</label><input type="text" id="notes" name="notes" value="">
			</div>
			<div style="margin-top:18px; text-align:center;">
				<button type="button" onclick="submitSection('dues')" style="margin-right:12px;">Save</button>
				<button type="button" onclick="closeModal('duesModal')">Cancel</button>
			</div>
		</form>
	</div>
</div>

<!-- Edit Dues Payment Modal -->
<div id="editDueModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
	<div style="background-color:#f5f5f5; margin:10% auto; padding:20px; border:1px solid #888; width:370px; border-radius:8px; position:relative;">
		<button onclick="closeModal('editDueModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
		<h3 style="text-align:center;">Edit Dues Payment</h3>
		<form id="editDueForm">
			<input type="hidden" name="due_id" id="edit_due_id" value="">
			<div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
				<label for="edit_payment_date">Payment Date:</label><input type="date" id="edit_payment_date" name="payment_date" value="">
				<label for="edit_year">Year:</label><input type="text" id="edit_year" name="year" value="">
				<label for="edit_amount">Amount:</label><input type="number" id="edit_amount" name="amount" step="0.01">
				<label for="edit_method">Method:</label><input type="text" id="edit_method" name="method" value="">
				<label for="edit_due_notes">Notes:</label><input type="text" id="edit_due_notes" name="notes" value="">
			</div>
			<div style="margin-top:18px; text-align:center;">
				<button type="button" onclick="submitEditDue()" style="margin-right:12px;">Save</button>
				<button type="button" onclick="closeModal('editDueModal')">Cancel</button>
			</div>
		</form>
	</div>
</div>

<script>
function editDue(dueId) {
	fetch(`/get_due/${dueId}`)
		.then(response => response.json())
		.then(data => {
			if (data.error) {
				alert(data.error);
				return;
			}
			openModal('editDueModal');
			document.getElementById('edit_due_id').value = data.id;
			document.getElementById('edit_payment_date').value = data.payment_date;
			document.getElementById('edit_year').value = data.year;
			document.getElementById('edit_amount').value = parseFloat(data.amount).toFixed(2);
			document.getElementById('edit_method').value = data.method ? data.method : '';
			const notesField = document.getElementById('edit_due_notes');
			if (notesField) {
				notesField.value = data.notes;
				console.log('Notes field found, value set:', data.notes);
			} else {
				console.log('Notes field NOT found');
			}
		});
}

function submitEditDue() {
	var form = document.getElementById('editDueForm');
	var formData = new FormData(form);
	fetch(`/edit_due/${formData.get('due_id')}`, {
		method: 'POST',
		body: formData
	}).then(response => {
		if (response.ok) {
			location.reload();
		} else {
			alert('Error saving changes');
		}
	});
}

function deleteDue(dueId) {
	if (confirm('Are you sure you want to delete this dues payment?')) {
		fetch(`/delete_due/${dueId}`, { method: 'POST' })
			.then(response => {
				if (response.ok) {
					location.reload();
				} else {
					alert('Error deleting due');
				}
			});
	}
}

function openModal(id) {
	document.getElementById(id).style.display = 'block';
}

function closeModal(id) {
	document.getElementById(id).style.display = 'none';
}

function submitSection(section) {
	var formId = section === 'committees' ? 'editCommitteesForm' : section + 'Form';
	var form = document.getElementById(formId);
	var formData = new FormData(form);
	let url;
	if (section === 'committees') {
		url = `/edit_committees/${formData.get('member_id')}`;
	} else {
		url = `/edit_section/${formData.get('member_id')}?section=${section}`;
	}
	fetch(url, {
		method: 'POST',
		body: formData
	}).then(response => {
		if (response.ok) {
			location.reload();
		} else {
			alert('Error saving changes');
		}
	});
}

function sortTable(tableId, colIdx) {
    var table = document.getElementById(tableId);
    var rows = Array.from(table.rows).slice(1); // skip header
    var asc = table.getAttribute('data-sort-col') == colIdx && table.getAttribute('data-sort-dir') == 'asc' ? false : true;
    rows.sort(function(a, b) {
        var aText = a.cells[colIdx].innerText.trim();
        var bText = b.cells[colIdx].innerText.trim();
        // Numeric sort for Year and Amount
        if (colIdx === 0) {
            return asc ? (parseFloat(aText) - parseFloat(bText)) : (parseFloat(bText) - parseFloat(aText));
        }
        if (colIdx === 2) { // Amount column
            aText = aText.replace(/[^\d.\-]/g, '');
            bText = bText.replace(/[^\d.\-]/g, '');
            return asc ? (parseFloat(aText) - parseFloat(bText)) : (parseFloat(bText) - parseFloat(aText));
        }
        // Date sort for Payment Date
        if (colIdx === 1) {
            var aDate = Date.parse(aText);
            var bDate = Date.parse(bText);
            return asc ? (aDate - bDate) : (bDate - aDate);
        }
        // String sort for Method/Notes
        return asc ? aText.localeCompare(bText) : bText.localeCompare(aText);
    });
    // Remove old rows
    for (var i = 1; i < table.rows.length; i++) {
        table.deleteRow(1);
    }
    // Add sorted rows
    rows.forEach(function(row) {
        table.tBodies[0].appendChild(row);
    });
    table.setAttribute('data-sort-col', colIdx);
    table.setAttribute('data-sort-dir', asc ? 'asc' : 'desc');
    updateSortIcons(tableId, colIdx, asc);
}

function updateSortIcons(tableId, colIdx, asc) {
    for (let i = 0; i < 5; i++) {
        const th = document.getElementById('dues-sort-' + i);
        if (th) {
            th.textContent = th.textContent.replace(' ‚ñ≤', '').replace(' ‚ñº', '');
        }
    }
    const arrow = asc ? ' ‚ñ≤' : ' ‚ñº';
    const th = document.getElementById('dues-sort-' + colIdx);
    if (th) th.textContent = th.textContent + arrow;
}
</script>
