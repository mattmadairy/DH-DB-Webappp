<!DOCTYPE html>
<html>
<head>
    <title>Meeting Minutes - Dug Hill Rod & Gun Club</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='Main_Logo-removebg-preview.png') }}">
    <style>
        body { background-color: #f5f5f5; font-family: Arial, Helvetica, sans-serif; }
        .main-content { margin-left:210px; display:flex; flex-direction:column; align-items:center; }
        .documents-container { width: 100%; max-width: 1250px; margin: 0 auto; box-sizing: border-box; }
        .documents-card { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 20px; margin-bottom: 20px; }
        .card-header { border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px; }
        .card-title { margin: 0; color: #384839; font-size: 1.5em; }
        .document-list { column-count: 2; column-gap: 20px; max-width: 100%; box-sizing: border-box; column-fill: balance; }
        .document-item { background: #f8f8f8; padding: 15px; border-radius: 6px; border: 1px solid #ddd; transition: all 0.2s; break-inside: avoid; page-break-inside: avoid; }
        .document-item:hover { background: #e8f4fd; border-color: #007bff; }
        .document-title { font-weight: bold; color: #333; margin-bottom: 8px; }
        .document-description { color: #666; font-size: 0.9em; margin-bottom: 10px; }
        .document-link { display: inline-block; background: #007bff; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; font-size: 0.9em; }
        .document-link:hover { background: #0056b3; }
        .upload-btn { display: inline-block; background: #28a745; color: white; padding: 6px 12px; text-decoration: none; border-radius: 4px; font-size: 0.8em; margin-left: 8px; cursor: pointer; }
        .document-actions { margin-top: 10px; }
        .document-actions > * { margin-right: 8px; }
        .document-actions > *:last-child { margin-right: 0; }
        .no-documents { text-align: center; color: #666; font-style: italic; padding: 40px; }
    </style>
</head>
<body style="background-color:#384839; font-family:Arial, Helvetica, sans-serif;">
    <div style="display:flex; flex-direction:row;">
        <!-- Static Side Menu -->
        <div style="position:fixed; top:0; left:0; height:100vh; width:210px; background-color:#2c332b; display:flex; flex-direction:column; align-items:center; padding-top:120px; z-index:100; box-shadow:2px 0 8px rgba(0,0,0,0.08); overflow-y:auto;">
            <img src="{{ url_for('static', filename='Main_Logo-removebg-preview.png') }}" alt="Main Logo" style="height:143px; margin-top:-88px; margin-left:-8px; margin-bottom:34px;">
            <a href="{{ url_for('member_dashboard') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; {% if active_page == 'dashboard' %}background-color:rgb(255,255,0); color:#384839; font-weight:bold;{% else %}background-color:#eaeaea; color:#384839; font-weight:normal;{% endif %} text-decoration:none; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üè† Dashboard</a>
            <a href="{{ url_for('member_documents') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; {% if active_page == 'documents' %}background-color:rgb(255,255,0); color:#384839; font-weight:bold;{% else %}background-color:#eaeaea; color:#384839; font-weight:normal;{% endif %} text-decoration:none; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üìÑ Documents</a>
            <a href="{{ url_for('member_meeting_minutes') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; {% if active_page == 'meeting-minutes' %}background-color:rgb(255,255,0); color:#384839; font-weight:bold;{% else %}background-color:#eaeaea; color:#384839; font-weight:normal;{% endif %} text-decoration:none; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üìù Meeting Minutes</a>
            {% if is_admin %}
            <a href="{{ url_for('admin_dashboard') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#007bff; color:#ffffff; text-decoration:none; font-weight:bold; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üè† Admin Home</a>
            {% endif %}
            <a href="{{ url_for('logout') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#d9534f; color:#ffffff; text-decoration:none; font-weight:bold; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üö™ Logout</a>
        </div>

        <!-- Main content area -->
        <div class="main-content">
            <div style="display:flex; flex-direction:row; align-items:center; justify-content:center; margin-bottom:20px; width:100%;">
                <div style="text-align:center; width:100%;">
                    <h1 style="margin-bottom:0.2em; color:#f5f5f5; font-size:3em;">Dug Hill Rod & Gun Club</h1>
                    <h1 style="margin-top:0.2em; color:#f5f5f5; font-size:3em;">Meeting Minutes</h1>
                </div>
            </div>

            <div class="documents-container">
                <!-- Meeting Minutes Section -->
                <div class="documents-card">
                    <div class="card-header">
                        <h2 class="card-title">üìù Meeting Minutes</h2>
                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                            <form method="get" style="display: flex; align-items: center; gap: 10px;">
                                <label for="year_filter" style="font-weight: bold; color: #384839;">Filter by Year:</label>
                                <select name="year" id="year_filter" onchange="this.form.submit()" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; background: white;">
                                    <option value="all" {% if selected_year == 'all' %}selected{% endif %}>All Years</option>
                                    {% for year in available_years %}
                                    <option value="{{ year }}" {% if selected_year == year %}selected{% endif %}>{{ year }}</option>
                                    {% endfor %}
                                    {% if '2026' not in available_years %}
                                    <option value="2026" {% if selected_year == '2026' %}selected{% endif %}>2026</option>
                                    {% endif %}
                                </select>
                            </form>
                            {% if is_admin %}
                            <button onclick="event.preventDefault(); event.stopPropagation(); openAddMinutesModal()" class="upload-btn" style="background: #28a745;">‚ûï Add Meeting Minutes</button>
                            {% endif %}
                        </div>
                    </div>

                    <div class="document-list">
                        {% if meeting_minutes %}
                        {% for minutes in meeting_minutes %}
                        <div class="document-item">
                            <div class="document-title">üìÖ {{ minutes.title }}</div>
                            <div class="document-description">
                                Meeting minutes from {{ minutes.meeting_date }}
                            </div>
                            <div class="document-actions">
                                {% if is_admin %}
                                <button onclick="event.preventDefault(); event.stopPropagation(); editMinutes({{ minutes.id }}, '{{ minutes.title }}', '{{ minutes.meeting_date }}', '', '')" class="upload-btn" style="background: #17a2b8; padding: 6px 16px;">‚úèÔ∏è Edit</button>
                                <form method="post" action="{{ url_for('delete_meeting_minutes', minutes_id=minutes.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete these meeting minutes?')">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="submit" class="upload-btn" style="background: #dc3545;">üóëÔ∏è Delete</button>
                                </form>
                                {% endif %}
                                {% if minutes.pdf_filename %}
                                <a href="{{ url_for('static', filename=minutes.pdf_filename) }}" class="document-link" target="_blank">üìé View PDF</a>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="document-item">
                            <div class="document-title">No meeting minutes available</div>
                            <div class="document-description">Meeting minutes will appear here once they are added by an administrator.</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Meeting Minutes Modal -->
    <div id="addMinutesModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
        <div id="addMinutesModalContent" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); width: 90%; max-width: 600px;">
            <h3 style="margin-top: 0; color: #384839;">Add Meeting Minutes</h3>
            <form method="post" enctype="multipart/form-data" action="{{ url_for('add_meeting_minutes') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div style="margin-bottom: 15px;">
                    <label for="minutes_title" style="display: block; margin-bottom: 5px; font-weight: bold;">Meeting Title:</label>
                    <input type="text" id="minutes_title" name="title" placeholder="e.g., January 2026 Board Meeting" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="minutes_date" style="display: block; margin-bottom: 5px; font-weight: bold;">Meeting Date:</label>
                    <input type="date" id="minutes_date" name="meeting_date" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label for="minutes_file" style="display: block; margin-bottom: 5px; font-weight: bold;">Attach PDF (optional):</label>
                    <input type="file" id="minutes_file" name="file" accept=".pdf" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>

                <div style="text-align: right;">
                    <button type="button" onclick="closeAddMinutesModal()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; margin-right: 10px; cursor: pointer;">Cancel</button>
                    <button type="submit" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Add Minutes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Meeting Minutes Modal -->
    <div id="editMinutesModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
        <div id="editMinutesModalContent" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); width: 90%; max-width: 600px;">
            <h3 style="margin-top: 0; color: #384839;">Edit Meeting Minutes</h3>
            <form method="post" enctype="multipart/form-data" id="editMinutesForm">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" id="edit_minutes_id" name="minutes_id">

                <div style="margin-bottom: 15px;">
                    <label for="edit_minutes_title" style="display: block; margin-bottom: 5px; font-weight: bold;">Meeting Title:</label>
                    <input type="text" id="edit_minutes_title" name="title" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label for="edit_minutes_date" style="display: block; margin-bottom: 5px; font-weight: bold;">Meeting Date:</label>
                    <input type="date" id="edit_minutes_date" name="meeting_date" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label for="edit_minutes_file" style="display: block; margin-bottom: 5px; font-weight: bold;">Attach PDF (optional - replaces existing):</label>
                    <input type="file" id="edit_minutes_file" name="pdf_file" accept=".pdf" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                </div>

                <div style="text-align: right;">
                    <button type="button" onclick="closeEditMinutesModal()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; margin-right: 10px; cursor: pointer;">Cancel</button>
                    <button type="submit" style="padding: 8px 16px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer;">Update Minutes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initialize modal event listeners when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Add click listeners to modal backgrounds to close when clicking outside content
            document.getElementById('addMinutesModal').addEventListener('click', function(e) {
                var modalContent = document.getElementById('addMinutesModalContent');
                if (!modalContent.contains(e.target)) {
                    closeAddMinutesModal();
                }
            });

            document.getElementById('editMinutesModal').addEventListener('click', function(e) {
                var modalContent = document.getElementById('editMinutesModalContent');
                if (!modalContent.contains(e.target)) {
                    closeEditMinutesModal();
                }
            });
        });

        // Meeting Minutes functions
        function openAddMinutesModal() {
            document.getElementById('addMinutesModal').style.display = 'block';
        }

        function closeAddMinutesModal() {
            document.getElementById('addMinutesModal').style.display = 'none';
            // Reset form
            document.getElementById('minutes_title').value = '';
            document.getElementById('minutes_date').value = '';
            document.getElementById('minutes_file').value = '';
        }

        function editMinutes(minutesId, title, date, description, content) {
            // Populate edit modal with existing data
            document.getElementById('edit_minutes_id').value = minutesId;
            document.getElementById('edit_minutes_title').value = title;
            document.getElementById('edit_minutes_date').value = date;
            // Set form action dynamically
            document.getElementById('editMinutesForm').action = '/edit_meeting_minutes/' + minutesId;
            // Show edit modal
            document.getElementById('editMinutesModal').style.display = 'block';
        }

        function closeEditMinutesModal() {
            document.getElementById('editMinutesModal').style.display = 'none';
        }
    </script>
</body>
</html>