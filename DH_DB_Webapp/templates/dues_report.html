<!DOCTYPE html>
<html>
<head>
    <title>Dues Report - Dug Hill Rod & Gun Club</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='Main_Logo-removebg-preview.png') }}">
    <style>
        .active-menu {
            background-color: rgb(255,255,0) !important;
            font-weight: bold !important;
        }
        .submenu {
            display: none;
            flex-direction: column;
            margin-left: 10px;
        }
        .submenu.active {
            display: flex;
        }
        .submenu a {
            width: 160px !important;
            font-size: 0.9em !important;
            padding: 8px 0 !important;
            margin-bottom: 6px !important;
        }
        .menu-toggle {
            cursor: pointer;
            user-select: none;
        }
        body { background-color: #f5f5f5; font-family: Arial, Helvetica, sans-serif; }
        .main-content { margin-left:210px; display:flex; flex-direction:column; align-items:center; }
        .attendance-header { display:flex; align-items:center; justify-content:center; margin-top:24px; margin-bottom:8px; }
        .attendance-header img { height:90px; margin:0 32px; }
        .attendance-header-text { text-align:center; }
        .attendance-header-text h1, .attendance-header-text h2 { color:#000; margin:0; }
        table { width:100%; max-width:700px; margin:auto; border-collapse:collapse; background:#f5f5f5; }
        th, td { border:2px solid #384839; padding:8px; text-align:center; }
        th { background:#eaeaea; color:#222; cursor:pointer; }
        .print-btn { margin-left:8px; padding:6px 18px; font-size:1.1em; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; cursor:pointer; }
        .hide-names-label { font-size:1em; color:#384839; margin-left:12px; }
        .print-header, #generatedLine {
            display: none;
        }
        @media print {
            /* Hide everything except print-header and duesTable */
            .side-menu, .print-btn, .hide-names-label, form[action*='dues_report'] {
                display: none !important;
            }
            .print-header, .print-header * {
                display: block !important;
                visibility: visible !important;
            }
            #duesTable {
                display: table !important;
                visibility: visible !important;
            }
            #duesTable thead {
                display: table-header-group !important;
            }
            #duesTable tbody {
                display: table-row-group !important;
            }
            #duesTable tr {
                display: table-row !important;
            }
            #duesTable th, #duesTable td {
                display: table-cell !important;
                visibility: visible !important;
            }
            .print-header {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                z-index: 1000 !important;
                background: #fff !important;
                margin: 0 !important;
                padding: 0.5em 0 0 0 !important;
                text-align: center !important;
            }
            #duesTable {
                position: static !important;
                top: 0 !important;
                left: auto !important;
                transform: none !important;
                width: 100vw !important;
                background: #fff !important;
                box-sizing: border-box !important;
            }
            .print-header {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                z-index: 1000 !important;
                background: #fff !important;
                margin: 0 !important;
                padding: 0.5em 0 0 0 !important;
                text-align: center !important;
            }
            body {
                margin: 0 !important;
                padding: 0 !important;
            }
            #duesTable {
                position: absolute !important;
                top: 4em !important;
            }
            .print-header h1, .print-header h2, #generatedLine {
                color: #000 !important;
            }
            .print-header h3, .print-header span {
                color: #000 !important;
                font-weight: normal !important;
            }
            body.hide-names-print .name-col {
                display: none !important;
            }
            @media print {
                body.hide-names-print .name-col {
                    display: none !important;
                }
            }
            .print-header, #generatedLine {
                display: block !important;
                visibility: visible !important;
                position: relative !important;
            }
            .print-header h1, .print-header h2 {
                display: block !important;
                visibility: visible !important;
            }
            /* Hide page header/subheader outside print-header */
            body > div > div > div > h1,
            body > div > div > div > h2,
            body > div > div > div[style*="text-align:center"] {
                display: none !important;
                visibility: hidden !important;
            }
            body * {
                visibility: hidden !important;
            }
            .print-header, #generatedLine, .print-header * {
                visibility: visible !important;
            }
            #duesTable, #duesTable * {
                visibility: visible !important;
            }
            #duesTable {
                position: absolute !important;
                left: 50% !important;
                top: 16em !important;
                transform: translateX(-50%) !important;
                margin: 0 !important;
                width: 100vw !important;
                border-collapse: collapse !important;
                background: #fff !important;
                box-sizing: border-box !important;
            }
            th, td {
                border: 2px solid #222 !important;
                padding: 8px !important;
                color: #000 !important;
                background: none !important;
                font-family: Arial, Helvetica, sans-serif !important;
                font-size: 1em !important;
            }
        }
    </style>
<style>
    .active-menu {
        background-color: rgb(255,255,0) !important;
    }
</style>
</head>

<body style="background-color:#384839; font-family:Arial, Helvetica, sans-serif;">
        <div style="color:yellow; background:#222; font-size:1.1em; padding:8px 16px; margin:12px 0; border-radius:6px; z-index:9999; position:relative;">
        </div>
    <!-- Print header and table for print preview, outside main flex container -->
    <div class="print-header" style="display:none;">
        <h1 style="margin:0; line-height:1.1; font-size:2em;">Dug Hill Rod & Gun Club</h1>
    <h1 style="margin:0; line-height:1.1; font-size:2em;">Membership Database</h1>
    <div style="height:0.7em;"></div>
    <h2 style="margin:0; line-height:1.1;">Dues Report</h2>
    <div style="height:1em;"></div>
    <span style="font-size:1.17em; font-weight:normal; text-align:center;">
    {% if selected_year %}Year: {{ selected_year }}<br>{% endif %}Total Records: {{ dues|length }}<br>Total Revenue: ${{ '%.2f'|format(total_dues_revenue) }}
    </span>
    </div>
        <style>
            body.hide-names-print .name-col {
                display: none !important;
            }
            body.hide-names-print .name-col, body.hide-names-print th.name-col {
                display: none !important;
            }
            @media print {
                body.hide-names-print #duesTable .name-col,
                body.hide-names-print #duesTable th.name-col {
                    display: none !important;
                }
            }
        </style>
    <div style="display:flex; flex-direction:row;">
        <!-- Static Side Menu -->
        <div style="position:fixed; top:0; left:0; height:100vh; width:210px; background-color:#2c332b; display:flex; flex-direction:column; align-items:center; padding-top:120px; z-index:100; box-shadow:2px 0 8px rgba(0,0,0,0.08); overflow-y:auto;">
            <img src="{{ url_for('static', filename='Main_Logo-removebg-preview.png') }}" alt="Main Logo" style="height:143px; margin-top:-88px; margin-left:-8px; margin-bottom:34px;">
            <a href="{{ url_for('admin_dashboard') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#007bff; color:#ffffff; text-decoration:none; font-weight:bold; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üè† Admin Home</a>
            <a href="javascript:void(0);" onclick="openModal('addMemberModal')" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">‚ûï Add Member</a>
            {% if current_user.is_admin_or_bdfl() %}
            <a href="{{ url_for('admin_applications') }}" class="{{ 'active-menu' if active_page == 'admin_applications' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'admin_applications' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center; position:relative;">üìã Applications{% if pending_applications > 0 %}<span style="position:absolute; top:-5px; right:-5px; background-color:#dc3545; color:white; border-radius:50%; padding:2px 6px; font-size:0.75em; font-weight:bold; min-width:18px; text-align:center;">{{ pending_applications }}</span>{% endif %}</a>
            {% endif %}
            <a href="{{ url_for('recycle_bin') }}" class="{{ 'active-menu' if active_page == 'recycle_bin' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'recycle_bin' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üóëÔ∏è Recycle Bin</a>
            <a href="{{ url_for('bulk_actions') }}" class="{{ 'active-menu' if active_page == 'bulk_actions' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'bulk_actions' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">‚ö° Bulk Actions</a>
            
            <div class="menu-toggle" onclick="toggleSubmenu()" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">
                üìä Reports <span id="submenu-arrow">‚ñº</span>
            </div>
            <div id="reports-submenu" class="submenu {% if active_page in ['dues_report', 'work_hours_report', 'meeting_attendance_report', 'kiosk_report'] %}active{% endif %}">
                <a href="{{ url_for('dues_report') }}" class="{{ 'active-menu' if active_page == 'dues_report' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'dues_report' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üíµ Dues</a>
                <a href="{{ url_for('work_hours_report') }}" class="{{ 'active-menu' if active_page == 'work_hours_report' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'work_hours_report' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">
                    <img src="{{ url_for('static', filename='icon_work_hours.svg') }}" alt="Work Hours" style="height:1em; vertical-align:middle; margin-right:6px;"> Work Hours
                </a>
                <a href="{{ url_for('meeting_attendance_report') }}" class="{{ 'active-menu' if active_page == 'meeting_attendance_report' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'meeting_attendance_report' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">
                    <img src="{{ url_for('static', filename='icon_attendance.svg') }}" alt="Attendance" style="height:1em; vertical-align:middle; margin-right:6px;"> Meeting Attendance
                </a>
                <a href="{{ url_for('kiosk_report') }}" class="{{ 'active-menu' if active_page == 'kiosk_report' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'kiosk_report' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üü© Check-ins</a>
            </div>
            
            <a href="{{ url_for('committees') }}" class="{{ 'active-menu' if active_page == 'committees' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:{{ 'bold' if active_page == 'committees' else 'normal' }}; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üë• Committees</a>
            <!-- Email List button removed -->
            <a href="{{ url_for('kiosk') }}" target="_blank" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; text-decoration:none; font-weight:normal; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üñ•Ô∏è Kiosk</a>
            {% if current_user.is_admin_or_bdfl() %}
            <a href="{{ url_for('admin_users') }}" class="{{ 'active-menu' if active_page == 'admin_users' else '' }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:{{ '#5bc0de' if active_page != 'admin_users' else 'rgb(255,255,0)' }}; color:{{ '#ffffff' if active_page != 'admin_users' else '#000000' }}; text-decoration:none; font-weight:bold; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center; position:relative;">
                <span style="display: flex; align-items: center; width: 100%; justify-content: center; text-align: center;">
                    <span style="display:inline-block; vertical-align:middle;">üë§ User Management</span>
                </span>
            </a>
            {% endif %}
            <a href="{{ url_for('member_dashboard') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#28a745; color:#ffffff; text-decoration:none; font-weight:bold; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üë§ Members Area</a>
            <a href="{{ url_for('logout') }}" style="width:170px; display:inline-block; padding:10px 0; margin-bottom:10px; border-radius:6px; border:1px solid #384839; background-color:#d9534f; color:#ffffff; text-decoration:none; font-weight:bold; font-size:1em; font-family:Arial, Helvetica, sans-serif; box-shadow:0 1px 2px rgba(0,0,0,0.04); text-align:center;">üö™ Logout</a>
                        <div style="color:yellow; background:#222; font-size:0.9em; padding:4px 8px; margin:8px 0; border-radius:4px;">
                        </div>
            <div style="width:170px; margin-top:20px; padding:10px; border-top:1px solid #384839;">
                <div style="color:#f5f5f5; font-size:0.9em; line-height:1.6; text-align:left;">
                    <div style="margin-bottom:8px;"><strong>Life:</strong> {{ member_stats.life_members }}</div>
                    <div style="margin-bottom:8px;"><strong>Probationary, Associate, & Active:</strong> {{ member_stats.voting_members }}</div>
                    <div style="border-top:1px solid #555; padding-top:8px;"><strong>Total:</strong> {{ member_stats.total_members }}</div>
                </div>
            </div>
        </div>
        <!-- Main content area shifted right to accommodate side menu -->
        <div style="flex:1; margin-left:210px; display:flex; flex-direction:column; align-items:center;">
            <div style="display:flex; flex-direction:row; justify-content:center; margin-bottom:20px; width:100%;">
                <div style="text-align:center; width:100%;">
                    <h1 style="margin-bottom:0.2em; color:#f5f5f5; font-size:3em;">Dug Hill Rod & Gun Club</h1>
                    <h1 style="margin-top:0.2em; color:#f5f5f5; font-size:3em;">Membership Database</h1>
                    <h2 style="font-size:2.2em; margin-bottom:0.2em; margin-top:0; text-align:center; color:#f5f5f5; font-family:Arial, Helvetica, sans-serif; font-weight:bold; text-decoration:underline;">Dues Report</h2>
                </div>
            </div>
            <div style="background-color:#f5f5f5; border-radius:8px; padding:32px; min-width:400px; min-height:200px; box-shadow:0 2px 8px rgba(0,0,0,0.08); margin-bottom:40px; margin-top:24px; width:100%; max-width:800px;">
                <form method="get" action="{{ url_for('dues_report') }}" style="margin-bottom:18px; display:inline-flex; align-items:center; gap:16px;"></form>
                <div style="display:flex; align-items:center; gap:16px; justify-content:center; margin-bottom:18px;">
                    <form method="get" action="{{ url_for('dues_report') }}" style="display:inline-flex; align-items:center; gap:16px; margin:0;">
                        <label for="year" style="font-size:1.1em; color:#384839; margin-right:8px;">Year:</label>
                        <select name="year" id="year" onchange="this.form.submit()" style="font-size:1.1em; padding:4px 12px; border-radius:6px; border:1px solid #384839;">
                            {% for y in years %}
                            {% if y != 'All' and y != 'all' %}
                            <option value="{{ y }}" {% if selected_year == y %}selected{% endif %}>{{ y }}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </form>
                    <button type="button" class="print-btn" onclick="addGeneratedLineAndPrint()" style="padding:6px 18px; font-size:1.1em; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; cursor:pointer; margin-left:8px;">üñ®Ô∏è Print Report</button>
                    <button type="button" class="print-btn" onclick="window.location.href='{{ url_for('dues_email_list', year=selected_year) }}'" style="padding:6px 18px; font-size:1.1em; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; cursor:pointer; margin-left:8px;">üìß Email List - Paid</button>
                    <button type="button" class="print-btn" onclick="window.location.href='{{ url_for('dues_unpaid_email_list', year=selected_year) }}'" style="padding:6px 18px; font-size:1.1em; border-radius:6px; border:1px solid #384839; background-color:#eaeaea; color:#384839; cursor:pointer; margin-left:8px;">üìß Email List - Unpaid</button>
                    <button type="button" class="print-btn" onclick="window.location.href='{{ url_for('dues_export_csv', year=selected_year) }}'" style="padding:6px 18px; font-size:1.1em; border-radius:6px; border:1px solid #384839; background-color:#28a745; color:#fff; cursor:pointer; margin-left:8px;">üì• Export CSV - Paid</button>
                    <button type="button" class="print-btn" onclick="window.location.href='{{ url_for('dues_unpaid_export_csv', year=selected_year) }}'" style="padding:6px 18px; font-size:1.1em; border-radius:6px; border:1px solid #384839; background-color:#28a745; color:#fff; cursor:pointer; margin-left:8px;">üì• Export CSV - Unpaid</button>
                    <label class="hide-names-label" style="font-size:1em; color:#384839; margin-left:12px;">
                        <input type="checkbox" id="hideNamesPrint" style="margin-right:6px; vertical-align:middle;" onclick="toggleHideNames()"> Hide Names in Print
                    </label>
                </div>
                <div style="text-align:center; margin-bottom:12px; font-size:1.1em; color:#384839; font-weight:bold;">
                    Total Records: {{ dues|length }}
                    <span style="margin-left:24px; font-weight:bold; color:#384839;">Total Revenue: ${{ '%.2f'|format(total_dues_revenue) }}</span>
                </div>
                <table id="duesTable" style="width:100%; max-width:700px; margin:auto; border-collapse:collapse;">
                    <thead>
                    <tr style="background:#eaeaea; color:#222;">
                        <th id="th0" style="padding:8px; border:2px solid #384839; cursor:pointer; text-align:center;" onclick="sortTable(0)">Badge # <span></span></th>
                        <th id="th1" class="name-col" style="padding:8px; border:2px solid #384839; cursor:pointer;" onclick="sortTable(1)">Name <span></span></th>
                        <th id="th2" style="padding:8px; border:2px solid #384839; cursor:pointer; text-align:center;" onclick="sortTable(2)">Year <span></span></th>
                        <th id="th3" style="padding:8px; border:2px solid #384839; cursor:pointer;" onclick="sortTable(3)">Payment Date <span></span></th>
                        <th id="th4" style="padding:8px; border:2px solid #384839; cursor:pointer;" onclick="sortTable(4)">Amount <span></span></th>
                        <th id="th5" style="padding:8px; border:2px solid #384839; cursor:pointer;" onclick="sortTable(5)">Method <span></span></th>
                        <th id="th6" style="padding:8px; border:2px solid #384839; cursor:pointer;" onclick="sortTable(6)">Notes <span></span></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for due in dues %}
                    <tr style="cursor:pointer;" onclick="goToMemberDetails({{ due['member_id'] }})">
                        <td style="padding:8px; border:2px solid #384839; text-align:center;">{{ due['badge_number'] }}</td>
                        <td class="name-col" style="padding:8px; border:2px solid #384839;">{{ due['first_name'] }} {{ due['last_name'] }}</td>
                        <td style="padding:8px; border:2px solid #384839; text-align:center;">{{ due['year'] }}</td>
                        <td style="padding:8px; border:2px solid #384839;">{{ due['payment_date']|format_mmddyyyy }}</td>
                        <td style="padding:8px; border:2px solid #384839;">${{ '%.2f'|format(due['amount']) }}</td>
                        <td style="padding:8px; border:2px solid #384839;">{{ due['method'] }}</td>
                        <td style="padding:8px; border:2px solid #384839;">{{ due['notes'] }}</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <!-- ...existing code... -->
                <script>
// Open member details page to Dues tab
function goToMemberDetails(memberId) {
    // Set localStorage so Dues tab is active
    localStorage.setItem('activeTab', 'tab-dues');
    window.location.href = '/member/' + memberId;
}
                // Hide names in print logic
                function toggleHideNames() {
                    var checked = document.getElementById('hideNamesPrint').checked;
                    if (checked) {
                        document.body.classList.add('hide-names-print');
                    } else {
                        document.body.classList.remove('hide-names-print');
                    }
                }
                // Refined sortable table with dynamic arrow
                let sortedCol = null;
                let sortDir = "asc";
                function sortTable(n) {
                    var table = document.getElementById("duesTable");
                    var rows, switching, i, x, y, shouldSwitch, switchcount = 0;
                    switching = true;
                    // Toggle direction if same column, else default to asc
                    if (sortedCol === n) {
                        sortDir = sortDir === "asc" ? "desc" : "asc";
                    } else {
                        sortDir = "asc";
                    }
                    sortedCol = n;
                    updateSortArrows();
                    while (switching) {
                        switching = false;
                        rows = table.rows;
                        for (i = 1; i < (rows.length - 1); i++) {
                            shouldSwitch = false;
                            x = rows[i].getElementsByTagName("TD")[n];
                            y = rows[i + 1].getElementsByTagName("TD")[n];
                            if (sortDir == "asc") {
                                if (compareCells(x, y, n) > 0) {
                                    shouldSwitch = true;
                                    break;
                                }
                            } else if (sortDir == "desc") {
                                if (compareCells(x, y, n) < 0) {
                                    shouldSwitch = true;
                                    break;
                                }
                            }
                        }
                        if (shouldSwitch) {
                            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                            switching = true;
                            switchcount++;
                        } else {
                            if (switchcount == 0 && sortDir == "asc") {
                                sortDir = "desc";
                                switching = true;
                            }
                        }
                    }
                }
                function updateSortArrows() {
                    for (let i = 0; i < 7; i++) {
                        let th = document.getElementById('th'+i);
                        let span = th.querySelector('span');
                        if (i === sortedCol) {
                            span.innerHTML = sortDir === "asc" ? "&#x25B2;" : "&#x25BC;";
                        } else {
                            span.innerHTML = "";
                        }
                    }
                }
                    function compareCells(x, y, n) {
                        // Badge #
                        if (n === 0) {
                            return parseInt(x.innerText) - parseInt(y.innerText);
                        }
                        // Name
                        if (n === 1) {
                            return x.innerText.localeCompare(y.innerText);
                        }
                        // Year
                        if (n === 2) {
                            return parseInt(x.innerText) - parseInt(y.innerText);
                        }
                        // Payment Date
                        if (n === 3) {
                            return new Date(x.innerText) - new Date(y.innerText);
                        }
                        // Amount
                        if (n === 4) {
                            return parseFloat(x.innerText.replace(/[^\d\.]/g, '')) - parseFloat(y.innerText.replace(/[^\d\.]/g, ''));
                        }
                        // Method
                        if (n === 5) {
                            return x.innerText.localeCompare(y.innerText);
                        }
                        // Notes
                        if (n === 6) {
                            return x.innerText.localeCompare(y.innerText);
                        }
                        return 0;
                    }
                </script>
                        <!-- Print button moved above table -->
        </div>
        <script>
        function toggleSubmenu() {
            var submenu = document.getElementById('reports-submenu');
            var arrow = document.getElementById('submenu-arrow');
            submenu.classList.toggle('active');
            arrow.textContent = submenu.classList.contains('active') ? '‚ñ≤' : '‚ñº';
        }
        <!-- Email List button removed -->
        function addGeneratedLineAndPrint() {
            window.print();
        }
        </script>
</body>
<!-- Add Member Modal -->
<div id="addMemberModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
    <div style="background-color:#f5f5f5; margin:4% auto; padding:20px; border:1px solid #888; width:420px; border-radius:8px; position:relative;">
        <button onclick="closeModal('addMemberModal')" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5em; color:#384839; cursor:pointer;">&times;</button>
        <h3 style="margin-top:0; text-align:center;">Add Member</h3>
        <form id="addMemberForm">
            <div style="display:grid; grid-template-columns:120px 1fr; gap:10px 12px; align-items:center;">
                <label for="badge_number">Badge Number:</label><input type="text" id="badge_number" name="badge_number" required>
                <label for="membership_type">Membership Type:</label>
                <select id="membership_type" name="membership_type" required>
                    <option value="Probationary">Probationary</option>
                    <option value="Associate">Associate</option>
                    <option value="Active">Active</option>
                    <option value="Life">Life</option>
                    <option value="Honorary">Honorary</option>
                    <option value="Prospective">Prospective</option>
                    <option value="Wait List">Wait List</option>
                    <option value="Former">Former</option>
                </select>
                <label for="first_name">First Name:</label><input type="text" id="first_name" name="first_name" required>
                <label for="middle_name">Middle Name:</label><input type="text" id="middle_name" name="middle_name">
                <label for="last_name">Last Name:</label><input type="text" id="last_name" name="last_name" required>
                <label for="suffix">Suffix:</label><input type="text" id="suffix" name="suffix">
                <label for="nickname">Nickname:</label><input type="text" id="nickname" name="nickname">
                <label for="dob">Date of Birth:</label><input type="date" id="dob" name="dob">
                <label for="email">Primary Email:</label><input type="email" id="email" name="email">
                <label for="email2">Secondary Email:</label><input type="email" id="email2" name="email2">
                <label for="phone">Primary Phone:</label><input type="text" id="phone" name="phone">
                <label for="phone2">Secondary Phone:</label><input type="text" id="phone2" name="phone2">
                <label for="address">Address:</label><input type="text" id="address" name="address">
                <label for="city">City:</label><input type="text" id="city" name="city">
                <label for="state">State:</label><input type="text" id="state" name="state">
                <label for="zip">Zip Code:</label><input type="text" id="zip" name="zip">
                <label for="join_date">Join Date:</label><input type="date" id="join_date" name="join_date">
                <label for="sponsor">Sponsor:</label><input type="text" id="sponsor" name="sponsor">
                <label for="card_internal">Card/Fob Internal Number:</label><input type="text" id="card_internal" name="card_internal">
                <label for="card_external">Card/Fob External Number:</label><input type="text" id="card_external" name="card_external">
            </div>
            <div style="margin-top:18px; text-align:center;">
                <button type="submit" style="padding:6px 18px; border-radius:6px; border:1px solid #384839; background:#eaeaea; color:#384839; cursor:pointer;">Add Member</button>
                <button type="button" onclick="closeModal('addMemberModal')" style="padding:6px 18px; border-radius:6px; border:1px solid #ccc; background:#f8f8f8; color:#333; cursor:pointer; margin-left:8px;">Cancel</button>
            </div>
        </form>
    </div>
</div>
<script>
function openModal(id) {
    document.getElementById(id).style.display = 'block';
    document.getElementById(id).style.zIndex = 2000;
}
function closeModal(id) {
    document.getElementById(id).style.display = 'none';
}
document.getElementById('addMemberForm').onsubmit = function(e) {
    e.preventDefault();
    var form = document.getElementById('addMemberForm');
    var formData = new FormData(form);
    fetch('/add_member', {
        method: 'POST',
        body: formData
    }).then(function(resp) {
        if (resp.ok) {
            location.reload();
        } else {
            alert('Error adding member');
        }
    });
};
</script>
</html>